= pgpool
:toc: 
:toc-title: ëª©ì°¨
:sectlinks:
:sectnums:

== pgpool ê°œìš”
PostgreSQL ì„œë²„ë¥¼ ì¶”ê°€ì ìœ¼ë¡œ êµ¬ì„±í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” Middle Wareì˜ í•œ ì¢…ë¥˜ì…ë‹ˆë‹¤. DB Clusteringì„ í•˜ê¸° ìœ„í•´ ìì£¼ ì‚¬ìš©ë©ë‹ˆë‹¤.

- pgpool wiki : https://www.pgpool.net/mediawiki/index.php/Main_Page

- pgpool documnetation(latest) : https://www.pgpool.net/docs/latest/en/html/index.html

image:images/pgpool_architecture.PNG[]

== Install
pgpool rpm íŒŒì¼ ì•„ì¹´ì´ë¸Œ ì‚¬ì´íŠ¸ : https://www.pgpool.net/yum/rpms/

=== pgpool-II ì„¤ì¹˜
----
yum install -y https://www.pgpool.net/yum/rpms/4.3/redhat/rhel-7-x86_64/pgpool-II-pg14-4.3.3-1pgdg.rhel7.x86_64.rpm
----

=== debugging_info, extension ì„¤ì¹˜
Extension ê¸°ëŠ¥ìœ¼ë¡œëŠ” pgpool-recovery, pgpool-adm, pgpool-regclass ê¸°ëŠ¥ì„ ì§€ì›í•˜ë„ë¡ í•©ë‹ˆë‹¤.
----
yum install -y https://www.pgpool.net/yum/rpms/4.3/redhat/rhel-7-x86_64/pgpool-II-pg14-debuginfo-4.3.3-1pgdg.rhel7.x86_64.rpm

yum install -y https://www.pgpool.net/yum/rpms/4.3/redhat/rhel-7-x86_64/pgpool-II-pg14-extensions-4.3.3-1pgdg.rhel7.x86_64.rpm
----
ì„¤ì¹˜ í›„ /etc/pgpool-II ë””ë ‰í† ë¦¬ê°€ ê¶Œí•œì´ rootì´ê¸° ë•Œë¬¸ì— ê¶Œí•œì„ ë³€ê²½í•´ì¤ë‹ˆë‹¤.
-----
chown -R hypersql:hypersql /etc/pgpool-II
-----

== pgpool-II ì‹¤í–‰ ì „ ì„¤ì •
=== SSH ì„¤ì •
ìë™ failover ë° online recoveryë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ê° ë…¸ë“œì˜ rootì™€ ì‚¬ìš©ì ê°„ì˜ ì•”í˜¸ ì—†ì´ SSH ì ‘ì†ì„ í•´ì•¼í•©ë‹ˆë‹¤.
----
mkdir ~/.ssh
chmod 700 ~/.ssh
cd ~/.ssh
ssh-keygen -t rsa

[all servers]# mkdir ~/.ssh
[all servers]# chmod 700 ~/.ssh
[all servers]# cd ~/.ssh
[all servers]# ssh-keygen -t rsa -f id_rsa_pgpool
[all servers]# ssh-copy-id -i id_rsa_pgpool.pub hypersql@[primary IP]
[all servers]# ssh-copy-id -i id_rsa_pgpool.pub hypersql@[standby IP]

[all servers]# su - postgres
[all servers]$ mkdir ~/.ssh
[all servers]$ chmod 700 ~/.ssh
[all servers]$ cd ~/.ssh
[all servers]$ ssh-keygen -t rsa -f id_rsa_pgpool
[all servers]$ ssh-copy-id -i id_rsa_pgpool.pub hypersql@[primary IP]
[all servers]$ ssh-copy-id -i id_rsa_pgpool.pub hypersql@[standby IP]

# ì ‘ì† í™•ì¸
ssh hypersql@[primary IP]
ssh hypersql@[standby IP]
----

=== ìœ ì € íŒ¨ìŠ¤ì›Œë“œ ì„¤ì • ë° `pool_passwd` íŒŒì¼ ì„¤ì •
----
psql
=# alter user postgres password '[PASSWORD]';
----

----
pg_md5 --md5auth -f /etc/pgpool-II/pgpool.conf -u postgres [PASSWORD]

cat /etc/pgpool-II/pool_passwd
----

=== `.pgpass` íŒŒì¼ ìƒì„± ë° ì„¤ì •
 * streaming replication ê³¼ online recovery ìˆ˜í–‰ì„ ìœ„í•´ ë°ì´í„°ë² ì´ìŠ¤ì— ì•”í˜¸ì—†ì´ ì ‘ì†í•˜ê¸° ìœ„í•´ ì„¤ì •í•©ë‹ˆë‹¤.
 * pgpool-II ì‚¬ìš©ìì˜ í™ˆ ë””ë ‰í† ë¦¬ì— ìƒì„±í•©ë‹ˆë‹¤.
 ** í™ˆ ë””ë ‰í† ë¦¬ì— ì„¤ì •í•˜ì§€ ì•Šì„ ê²½ìš° ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•´ì¤ë‹ˆë‹¤.
----
export PGPASSFILE='/hypersql/.pgpass'
----
* *hostname:port:database:username:password* ì˜ í˜•ì‹ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
----
[primary IP]:5432:postgres:postgres:password
[primary IP]:5432:postgres:repluser:password
[standby IP]:5432:postgres:postgres:password
[standby IP]:5432:postgres:repluser:password
*:*:*:*:password
----
* íŒ¨ìŠ¤ì›Œë“œë¥¼ ì œì™¸í•œ ëª¨ë“  í•­ëª©ì€ *** ë¡œ ëŒ€ì²´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
* íŒŒì¼ ìƒì„± í›„ ê¶Œí•œì„ ê¼­ *600* ìœ¼ë¡œ ë³€ê²½í•´ì¤ë‹ˆë‹¤.
----
chmod 600 ~/.pgpass
----

=== pgpool-II ë¡œê·¸ ë””ë ‰í† ë¦¬ ìƒì„± 
----
mkdir /hypersql/pg/14/log/pgpool
----

=== `pcp.conf` ì„¤ì •
- PCPí´ë¼ì´ì–¸íŠ¸ ë„êµ¬ëŠ” pgpool-IIì„¤ì •ê³¼ ë…ë¦½ì ì´ê³ , PCPë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ê³ ìœ ì˜ ì•„ì´ë””ì™€ passwordì´ê¸° ë•Œë¬¸ì— postgreSQLê³¼ëŠ” ë¬´ê´€í•©ë‹ˆë‹¤.
----
echo 'hypersql:'`pg_md5 [PCP PASSWORD]` >>/etc/pgpool-II/pcp.conf
vi /etc/pgpool-II/pcp.conf
----

=== `pgpool_node_id` ì„¤ì •
- watchdogì„ ì‚¬ìš©í•˜ë ¤ë©´ node idë¥¼ ì„¤ì •í•´ì£¼ì–´ì•¼í•©ë‹ˆë‹¤.
- primary ì„œë²„ëŠ” 0, standby ì„œë²„ëŠ” 1,2,3...ì„ ì…ë ¥
----
vi /etc/pgpool-II/pgpool_node_id
----

=== [ì„ íƒ] ë°©í™”ë²½ ì„¤ì •
- 9999 : pgpool-II í¬íŠ¸
- 9898 : PCP í¬íŠ¸
- 9000 : watchdog í¬íŠ¸
- 9694 : watchdogì˜ heartbeat í¬íŠ¸
----
firewall-cmd --permanent --zone=public --add-port=9999/tcp --add-port=9898/tcp --add-port=9000/tcp  --add-port=9694/udp
firewall-cmd --reload
----

== Authentication
pgpool-IIì€ PostgreSQLì„œë²„ì™€ Clientì˜ ë¯¸ë“¤ì›¨ì–´ì´ê¸° ë•Œë¬¸ì— PostgreSQLì„œë²„ì— ì ‘ì†ì„ í•˜ê¸° ìœ„í•´ì„œëŠ” íŠ¹ì • ì‚¬ìš©ìë¡œ ì¸ì¦ì„ í•´ì•¼í•©ë‹ˆë‹¤. ë³¸ ê¸€ì—ì„œëŠ” postgres ìœ ì €ë¡œ ì¸ì¦í•˜ëŠ” ë°©ë²•ì— ëŒ€í•˜ì—¬ ì„¤ëª…í•©ë‹ˆë‹¤.

=== Authentication methods in Pgpool-II
pgpool-II ì—ì„œëŠ” ì—¬ëŸ¬ ì¸ì¦ ë°©ë²•ì„ ì§€ì›í•©ë‹ˆë‹¤.

* Trust
    - ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ì‚¬ëŒì´ ê·¸ë“¤ì´ ì§€ì •í•œ ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©ì ì´ë¦„ìœ¼ë¡œ ì—°ê²°ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì´ ìˆìŒ
* MD5 Password
* scram-sha-256
    - pgpool-II 4.0 ë¶€í„° ì§€ì›
    - ê°€ì¥ ì•ˆì „í•œ ë¹„ë°€ë²ˆí˜¸ ê¸°ë°˜ ì¸ì¦ ë°©ì‹ì´ë¯€ë¡œ *ì ê·¹ ê¶Œì¥*
* Certificate
    - SSL í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ì„œë¥¼ ì‚¬ìš©í•˜ì—¬ ì¸ì¦ì„ ìˆ˜í–‰
* PAM
    - PAM(í”ŒëŸ¬ê·¸ ê°€ëŠ¥ ì¸ì¦ ëª¨ë“ˆ)ì„ ì¸ì¦ ë©”ì»¤ë‹ˆì¦˜ìœ¼ë¡œ ì‚¬ìš©
* LDAP 

=== Pgpool-II authentication mechanism
. ì‚¬ìš©ìê°€ pgpool-IIì— ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.
. pgpool-IIì´ ì´ ì‚¬ìš©ìì— ëŒ€í•œ ì¸ì¦ ë°©ë²•ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
    .. `enable_pool_hba`=on ì´ë©´ `pool_hba.conf` ì—ì„œ ì´ ì‚¬ìš©ìì— ëŒ€í•œ ì¸ì¦ ë°©ë²•ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
    .. `enable_pool_hba`=off ì´ë©´ **PostgreSQL**ì—ì„œ ì´ ì‚¬ìš©ìì— ëŒ€í•œ ì¸ì¦ ë°©ë²•ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
. pgpool-IIì€ `pool_passwd` íŒŒì¼ì—ì„œ ì´ ì‚¬ìš©ìì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.

    ğŸ’¡ .pgpass íŒŒì¼ì„ ìƒì„±í•˜ë©´ ë”°ë¡œ ì•”í˜¸ë¥¼ ì…ë ¥ ë°›ì§€ ì•Šê³  ì•„ë˜ ê³¼ì •ì„ ìƒëµí•˜ì—¬ ì¸ì¦ì´ ì§„í–‰ë©ë‹ˆë‹¤.  .pgpassì— ì…ë ¥ëœ ì•”í˜¸ì™€ `pool_passwd`ì— ì €ì¥ëœ ì•”í˜¸ì™€ ì¼ì¹˜í•˜ë©´ pgpool-IIëŠ” ê° ë°±ì—”ë“œ ì¸ì¦ì— ëŒ€í•´ `pool_passwd`ì— ì €ì¥ëœ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. 

. ì‚¬ìš©ìì—ê²Œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ë¼ëŠ” ë©”ì‹œì§€ê°€ í‘œì‹œë©ë‹ˆë‹¤.
. pgpool-IIì€ ë“¤ì–´ì˜¤ëŠ” ì‚¬ìš©ìê°€ ì…ë ¥í•œ ì•”í˜¸ë¥¼ í™•ì¸í•©ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ê°€ `pool_passwd`ì— ì €ì¥ëœ ë¹„ë°€ë²ˆí˜¸ì™€ ì¼ì¹˜í•˜ë©´ pgpool-IIëŠ” ê° ë°±ì—”ë“œ ì¸ì¦ì— ëŒ€í•´ `pool_passwd`ì— ì €ì¥ëœ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

==== Password File(pool_passwd)

- ì¸ì¦ì„ ìˆ˜í–‰í•˜ë ¤ë©´ pgpool-IIì— ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©ì ë° ì•”í˜¸ì˜ ëª©ë¡ì´ í¬í•¨ëœ Password Fileì´ í•„ìš”í•©ë‹ˆë‹¤.
- *user:password* ì˜ í˜•ì‹ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
- pgpool.confì˜ pool_password íŒŒë¼ë¯¸í„°ì— íŒŒì¼ì˜ ì´ë¦„ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
** default = â€˜pool_passwdâ€™
----
pool_passwd = 'pool_passwd'
----
* 3ê°€ì§€ ìœ í˜•ì˜ ì•”í˜¸ê°€ í¬í•¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
** pgpool-IIì€ ì ‘ë‘ì‚¬ë¡œ ì•”í˜¸ í˜•ì‹ìœ í˜•ì„ ì‹ë³„í•˜ë¯€ë¡œ *ê° í•­ëª©ì—ëŠ” ì•”í˜¸ í˜•ì‹ì´ ì ‘ë‘ì‚¬ë¡œ ì¶”ê°€ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.*
** Plain text: *TEXT* ì ‘ë‘ì‚¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•”í˜¸ë¥¼ ì¼ë°˜ í…ìŠ¤íŠ¸ í˜•ì‹ìœ¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤.
** AES256 encrypted password: *AES* ì ‘ë‘ì‚¬ë¥¼ ì‚¬ìš©í•˜ì—¬ AES256ì•”í˜¸í™”ëœ ì•”í˜¸ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.           
** MD5 hashed password: *md5* ì ‘ë‘ì‚¬ë¥¼ ì‚¬ìš©í•˜ì—¬ MD5 í•´ì‹œ ì•”í˜¸ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.   
** ë‹¤ìŒê³¼ ê°™ì€ í˜•ì‹ì˜ í…ìŠ¤íŠ¸ íŒŒì¼ì…ë‹ˆë‹¤.
----
user1:TEXTmypassword
user2:AESmzVzywsN1Z5GABhSAhwLSA==
user3:md5270e98c3db83dbc0e40f98d9bfe20972
...
----
* md5ëŠ” pg_md5ëª…ë ¹ì–´ë¡œ ìë™ ìƒì„± ê°€ëŠ¥í•©ë‹ˆë‹¤.
----
pg_md5 --md5auth -f /etc/pgpool-II/pgpool.conf -u username [PASSWORD]
----

==== pool_hba.conf
* pool_hba.conf ë¼ëŠ” íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ pgpool-II ì—ì„œ ì•¡ì„¸ìŠ¤ ì œì–´ ê·œì¹™ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
* í´ë¼ì´ì–¸íŠ¸ê°€ pgpool-IIë¥¼ í†µí•´ PostgreSQL ì„œë²„ì— ì—°ê²°í•˜ê¸° ë•Œë¬¸ì— PostgreSQLì€ ëª¨ë“  ì•¡ì„¸ìŠ¤ê°€ pgpool-IIê°€ ì‹¤í–‰ ì¤‘ì¸ í˜¸ìŠ¤íŠ¸ì—ì„œ ì˜¤ëŠ” ê²ƒìœ¼ë¡œ ê°„ì£¼í•©ë‹ˆë‹¤. ë”°ë¼ì„œ pgpool-II ì¸¡ì—ì„œ í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ì„ ì œì–´í•´ì•¼ í•©ë‹ˆë‹¤.
* pool_hba.conf ì„ ì‚¬ìš©í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì™€ pgpool-IIê°„ì˜ ì•¡ì„¸ìŠ¤ ì œì–´ë¥¼ í™œì„±í™”í•˜ë ¤ë©´ `enable_pool_hba` ë¥¼ ì¼œì•¼í•©ë‹ˆë‹¤. ê¸°ë³¸ê°’ì€ êº¼ì ¸ìˆìŠµë‹ˆë‹¤.

----
enable_pool_hba = on
----

- pool_hba.conf ì˜ í˜•ì‹ì€Â PostgreSQLì˜ pg_hba.conf í˜•ì‹ê³¼ ë§¤ìš° ë¹„ìŠ·í•©ë‹ˆë‹¤.

-----
# TYPE  DATABASE    USER        CIDR-ADDRESS          METHOD

# "local" is for Unix domain socket connections only
local   all         all                               trust
# IPv4 local connections:
host    all         all         127.0.0.1/32          trust
host    all         all         ::1/128               trust
host    all         all         [Primary IP]          trust
host    all         all         [Standby IP]          trust
-----

==== pg_hba.conf ì„¤ì •
-----
# TYPE  DATABASE    USER        CIDR-ADDRESS          METHOD

# "local" is for Unix domain socket connections only
local   all         all                               trust
# IPv4 local connections:
host    all         all         127.0.0.1/32          trust
host    all         all         ::1/128               trust
host    all         all         [Primary IP]          trust
host    all         all         [Standby IP]          trust
-----

=== Authentication for Pgpool-II internal tasks
- pgpool-IIì€ ë‚´ë¶€ì‘ì—…ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ pgpool.conf(`health_check_user`,`sr_check_user`,`recovery_user`,`wd_lifecheck_user``)ì˜ `*_password`` íŒŒë¼ë¯¸í„°ì—ì„œ ì‚¬ìš©ìì˜ ì•”í˜¸ë¥¼ ì§€ì •í•´ì•¼í•©ë‹ˆë‹¤.
- ë‹¤ìŒê³¼ ê°™ì´ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
----
health_check_user = 'postgres'
health_check_password = ''

sr_check_user = 'postgres'
sr_check_password = ''

Recovery_user = 'postgres'
recovery_password = 'password'

wd_lifecheck_user = 'postgres'
wd_lifecheck_password = ''
----
- `*_password` ê°€ ë¹„ì–´ ìˆìœ¼ë©´ pgpool-IIì€ pool_passwd íŒŒì¼ì—ì„œ ì•”í˜¸ë¥¼ ê°€ì ¸ì˜¤ë ¤ê³  ì‹œë„í•©ë‹ˆë‹¤.
- `*_password` ì€ 3ê°€ì§€ì˜ ì•”í˜¸ ìœ í˜•ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
** AES256
** md5 hash
** Plain TEXT

   ğŸ’¡ ë‹¨, `recovery_password` `wd_lifecheck_password` ì—ëŠ” md5 í•´ì‹œ ì•”í˜¸ë¥¼ ì§€ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.


== Configuration

ê¸°ë³¸ì ìœ¼ë¡œ ì„¤ì¹˜ê°€ ë˜ë©´ `/etc/pgpool-II` ê²½ë¡œì— ì„¤ì •íŒŒì¼ë“¤ì´ ìƒì„±ì´ ë©ë‹ˆë‹¤.

- Path : /etc/pgpool-II
- pgpool-II 4.2 ë¶€í„°ëŠ” ëª¨ë“  êµ¬ì„± íŒŒë¼ë¯¸í„°ê°€ ëª¨ë“  í˜¸ìŠ¤íŠ¸ì—ì„œ ë™ì¼í•˜ë¯€ë¡œ í•˜ë‚˜ì˜ pgpool ë…¸ë“œì—ì„œ pgpool.conf ë¥¼ í¸ì§‘í•˜ê³  ë‹¤ë¥¸ pgpool ë…¸ë“œì— ë³µì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- pgpool.conf
----
#------------------------------------------------------------------------------
# BACKEND CLUSTERING MODE
#------------------------------------------------------------------------------
backend_clustering_mode = 'streaming_replication'     
#------------------------------------------------------------------------------
# CONNECTIONS
#------------------------------------------------------------------------------

# - pgpool Connection Settings -

listen_addresses = '*'
port = 9999
socket_dir = '/var/run/hypersql'

# - pgpool Communication Manager Connection Settings -

pcp_listen_address = '*'
pcp_port = 9898
pcp_socket_dir = '/var/run/hypersql'

# - Backend Connection Settings -
backend_hostname0 = '[primary IP]'
backend_port0 = 5432
backend_weight0 = 1
backend_data_directory0 = '/hypersql/pg/14/data'
backend_flag0 = 'ALLOW_TO_FAILOVER'
backend_application_name0 = '[primary IP]'

backend_hostname1 = '[standby IP]'
backend_port1 = 5432
backend_weight1 = 1
backend_data_directory1 = '/hypersql/pg/14/data'
backend_flag1 = 'ALLOW_TO_FAILOVER'
backend_application_name1 = '[standby IP]'

# - Authentication -
enable_pool_hba = on

#------------------------------------------------------------------------------
# LOGS
#------------------------------------------------------------------------------

# - Where to log -

log_destination = 'stderr'

# This is used when logging to stderr:

logging_collector = on

# -- Only used if logging_collector is on ---

log_directory = '/hypersql/pg/14/log/pgpool'
log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log'
log_truncate_on_rotation = on
log_rotation_age = 1d
log_rotation_size = 10MB

#------------------------------------------------------------------------------
# FILE LOCATIONS
#------------------------------------------------------------------------------

pid_file_name = '/var/run/hypersql/pgpool.pid'

#------------------------------------------------------------------------------
# STREAMING REPLICATION MODE
#------------------------------------------------------------------------------

# - Streaming -

sr_check_period = 10                       
sr_check_user = 'postgres'                  
sr_check_password = ''                     
sr_check_database = 'postgres'             

# - Special commands -

follow_primary_command = '/etc/pgpool-II/follow_primary.sh %d %h %p %D %m %H %M %P %r %R'         

#------------------------------------------------------------------------------
# HEALTH CHECK PER NODE PARAMETERS (OPTIONAL)
#------------------------------------------------------------------------------

health_check_period = 10                   
health_check_timeout = 20                   
health_check_user = 'postgres'              
health_check_password = ''                  
health_check_database = 'postgres'          
health_check_max_retries = 3                

#------------------------------------------------------------------------------
# FAILOVER AND FAILBACK
#------------------------------------------------------------------------------

#failover_command = '/etc/pgpool-II/failover.sh %d %h %p %D %m %M %H %P %r %R'
                                   # Executes this command at failover

#------------------------------------------------------------------------------
# ONLINE RECOVERY
#------------------------------------------------------------------------------

recovery_user = 'postgres'
recovery_password = ''
recovery_timeout = 90
recovery_1st_stage_command = 'basebackup.sh'
load_balance_mode = on

#------------------------------------------------------------------------------
# WATCHDOG
#------------------------------------------------------------------------------

# - Enabling -

use_watchdog = on
                                    # Activates watchdog
                                    # (change requires restart)


# - Watchdog communication Settings -

hostname0 = '[primary IP]'
wd_port0 = 9000
pgpool_port0 = 9999

hostname1 = '[standby IP]'
wd_port1 = 9000
pgpool_port1 = 9999

wd_ipc_socket_dir = '/var/run/hypersql'
                                    # Unix domain socket path for watchdog IPC socket
                                    # The Debian package defaults to
                                    # /var/run/postgresql
                                    # (change requires restart)



# - Virtual IP control Setting -

delegate_IP = '[virtual IP]'
                                    # delegate IP address
                                    # If this is empty, virtual IP never bring up.
                                    # (change requires restart)
if_cmd_path = '/sbin'
                                    # path to the directory where if_up/down_cmd exists
                                    # If if_up/down_cmd starts with "/", if_cmd_path will be ignored.
                                    # (change requires restart)
if_up_cmd = '/usr/bin/sudo /sbin/ip addr add $_IP_$/24 dev [network device] label [virtual network device]'
                                    # startup delegate IP command
                                    # (change requires restart)
if_down_cmd = '/usr/bin/sudo /sbin/ip addr del $_IP_$/24 dev [network device]'
                                    # shutdown delegate IP command
                                    # (change requires restart)
arping_path = '/usr/sbin'
                                    # arping command path
                                    # If arping_cmd starts with "/", if_cmd_path will be ignored.
                                    # (change requires restart)
arping_cmd = '/usr/bin/sudo /usr/sbin/arping -U $_IP_$ -w 1 -I [network device]'
                                    # arping command
                                    # (change requires restart)

# - Behaivor on escalation Setting -

wd_escalation_command = '/etc/pgpool-II/escalation.sh'

# - Watchdog consensus settings for failover -

enable_consensus_with_half_votes = on
                                    # apply majority rule for consensus and quorum computation
                                    # at 50% of votes in a cluster with even number of nodes.
                                    # when enabled the existence of quorum and consensus
                                    # on failover is resolved after receiving half of the
                                    # total votes in the cluster, otherwise both these
                                    # decisions require at least one more vote than
                                    # half of the total votes.

# - Lifecheck Setting -
wd_lifecheck_method = 'heartbeat'
                                    # Method of watchdog lifecheck ('heartbeat' or 'query' or 'external')

wd_interval = 10

# -- heartbeat mode --
heartbeat_hostname0 = '[primary IP]'
heartbeat_port0 = 9694
heartbeat_device0 = ''

heartbeat_hostname1 = '[standby IP]'
heartbeat_port1 = 9694
heartbeat_device1 = ''

wd_heartbeat_keepalive = 2
wd_heartbeat_deadtime = 30

----

=== Configuration ì„¤ëª…

==== Clustering and Connection Settings
----
#------------------------------------------------------------------------------
# BACKEND CLUSTERING MODE
#------------------------------------------------------------------------------
backend_clustering_mode = 'streaming_replication'     
#------------------------------------------------------------------------------
# CONNECTIONS
#------------------------------------------------------------------------------

# - pgpool Connection Settings -

listen_addresses = '*'
port = 9999
socket_dir = '/var/run/hypersql'
----
* *backend_clustering_mode = 'streaming_replication'*
** í´ëŸ¬ìŠ¤í„°ë§ ëª¨ë“œëŠ” PostgreSQL ì„œë²„ë¥¼ ë™ê¸°í™” í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. 
** pgpool-IIì—ëŠ” ìŠ¤íŠ¸ë¦¬ë° ë³µì œëª¨ë“œ, ë…¼ë¦¬ì  ë³µì œëª¨ë“œ, ì£¼ ë³µì œëª¨ë“œ(ìŠ¬ë¡œë‹ˆ ëª¨ë“œ), raw ê·¸ë¦¬ê³  ìŠ¤ëƒ…ìƒ· ê²©ë¦¬ ëª¨ë“œì˜ 6ê°€ì§€ í´ëŸ¬ìŠ¤í„°ë§ ëª¨ë“œê°€ ìˆìŠµë‹ˆë‹¤.
** ìŠ¤íŠ¸ë¦¬ë° ëª¨ë“œê°€ ê°€ì¥ ë§ì´ ì‚¬ìš©ë˜ë©° pgpool-IIì„ ì‚¬ìš©í• ë•Œ ê°€ì¥ ê¶Œì¥í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.

* *listen_addresses = '*'*
** default = localhost
** pgpool ì—°ê²°ì„ í—ˆìš©í•  addressë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
** '*'ì€ ë“¤ì–´ì˜¤ëŠ” ëª¨ë“  ì—°ê²°ì„ í—ˆìš©í•©ë‹ˆë‹¤.
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì— ì„¤ì •í•´ì•¼í•©ë‹ˆë‹¤.

* *port = 9999*
** default = 9999
** pgpoolì˜ ì—°ê²°ì„ ìˆ˜ì‹ í•˜ê¸° ìœ„í•œ port numberë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì— ì„¤ì •í•´ì•¼í•©ë‹ˆë‹¤.


* *socket_dir = '/var/run/hypersql'*
** default = '/tmp'
** pgpool-II ì— ëŒ€í•œ ì—°ê²°ì„ ìˆ˜ë½í•˜ëŠ” UNIX ë„ë©”ì¸ ì†Œì¼“ ì´ ìƒì„±ë  ë””ë ‰í„°ë¦¬ì…ë‹ˆë‹¤.
** ì´ ì†Œì¼“ì€ cron ì‘ì—…ì— ì˜í•´ ì‚­ì œë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì´ ê°’ì„ /var/run/... ë””ë ‰í† ë¦¬ë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì— ì„¤ì •í•´ì•¼í•©ë‹ˆë‹¤.


==== PCP Settings
----
# - pgpool Communication Manager Connection Settings -

pcp_listen_address = '*'
pcp_port = 9898
pcp_socket_dir = '/var/run/hypersql'
----

* *pcp_listen_address = '*'*
** default = localhost
** pcp í”„ë¡œì„¸ìŠ¤ê°€ TCP/IP ì—°ê²°ì„ ìˆ˜ë½í•  í˜¸ìŠ¤íŠ¸ ì´ë¦„ ë˜ëŠ” IP ì£¼ì†Œë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
** '*'ì€ ë“¤ì–´ì˜¤ëŠ” ëª¨ë“  ì—°ê²°ì„ í—ˆìš©í•©ë‹ˆë‹¤.
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì— ì„¤ì •í•´ì•¼í•©ë‹ˆë‹¤.

* *pcp_port = 9898*
** default = 9898
** PCP í”„ë¡œì„¸ìŠ¤ê°€ ì—°ê²°ì„ ìˆ˜ì‹  ëŒ€ê¸°í•˜ëŠ” ë° ì‚¬ìš©í•˜ëŠ” í¬íŠ¸ ë²ˆí˜¸ì…ë‹ˆë‹¤. 
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì— ì„¤ì •í•´ì•¼í•©ë‹ˆë‹¤.


* *pcp_socket_dir = '/var/run/hypersql'*
** default = '/tmp'
** PCP í”„ë¡œì„¸ìŠ¤ì— ëŒ€í•œ ì—°ê²°ì„ ìˆ˜ë½í•˜ëŠ” UNIX ë„ë©”ì¸ ì†Œì¼“ì´ ìƒì„±ë  ë””ë ‰í„°ë¦¬ì…ë‹ˆë‹¤.
** ì´ ì†Œì¼“ì€ cron ì‘ì—…ì— ì˜í•´ ì‚­ì œë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì´ ê°’ì„ /var/run/... ë””ë ‰í† ë¦¬ë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì— ì„¤ì •í•´ì•¼í•©ë‹ˆë‹¤.

==== Backend Connection Settings
----
# - Backend Connection Settings -
backend_hostname0 = '[primary IP]'
backend_port0 = 5432
backend_weight0 = 1
backend_data_directory0 = '/hypersql/pg/14/data'
backend_flag0 = 'ALLOW_TO_FAILOVER'
backend_application_name0 = '[primary IP]'

backend_hostname1 = '[standby IP]'
backend_port1 = 5432
backend_weight1 = 1
backend_data_directory1 = '/hypersql/pg/14/data'
backend_flag1 = 'ALLOW_TO_FAILOVER'
backend_application_name1 = '[standby IP]'
----

   ğŸ’¡ [n]ì— ë“¤ì–´ê°ˆ ìˆ«ìëŠ” node id ì…ë‹ˆë‹¤.

* *backend_hostname[n] = '[IP]'*
** ì—°ê²°í•  PostgreSQL ë°±ì—”ë“œë¥¼ ì§€ì •í•©ë‹ˆë‹¤ .

* *backend_port[n] = 5432*
** ë°±ì—”ë“œì˜ í¬íŠ¸ ë²ˆí˜¸ë¥¼ ì§€ì •í•©ë‹ˆë‹¤. ë§¤ê°œë³€ìˆ˜ ì´ë¦„ ëì— ìˆ«ìë¥¼ ì¶”ê°€í•˜ì—¬ ì—¬ëŸ¬ ë°±ì—”ë“œë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤

* *backend_weight[n] = 1*
** ë°±ì—”ë“œì˜ ë¶€í•˜ ë¶„ì‚° ë¹„ìœ¨ì„ ì§€ì •í•©ë‹ˆë‹¤. 0ë³´ë‹¤ í¬ê±°ë‚˜ ê°™ì€ ì •ìˆ˜ ë˜ëŠ” ë¶€ë™ ì†Œìˆ˜ì  ê°’ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

* *backend_data_directory[n] = '/hypersql/pg/14/data'*
** ë°±ì—”ë“œì˜ ë°ì´í„°ë² ì´ìŠ¤ í´ëŸ¬ìŠ¤í„° ë””ë ‰í† ë¦¬ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
** Online Recoveryì¼ ê²½ìš°ì—ë§Œ í•´ë‹¹ íŒŒë¼ë¯¸í„°ê°€ ì‚¬ìš©ë©ë‹ˆë‹¤. í•´ë‹¹ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì§€ ì•Šì„ ê²½ìš°ì—ëŠ” ì„¤ì •í•˜ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤.

* *backend_flag[n] = 'ALLOW_TO_FAILOVER'*
** ë‹¤ì–‘í•œ ë°±ì—”ë“œ ë™ì‘ì„ ì œì–´í•©ë‹ˆë‹¤.
** '|' ë¥¼ ì‚¬ìš©í•˜ì—¬ ì—¬ëŸ¬ í”Œë˜ê·¸ë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
. `'ALLOW_TO_FAILOVER'` : ì¥ì•  ì¡°ì¹˜ ë˜ëŠ” ë°±ì—”ë“œ ë¶„ë¦¬ë¥¼ í—ˆìš©í•©ë‹ˆë‹¤. ì´ê²ƒì´ default ê°’ì…ë‹ˆë‹¤. DISALLOW_TO_FAILOVERì™€ ë™ì‹œì— ì§€ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
. `'DISALLOW_TO_FAILOVER'` : ë°±ì—”ë“œ ì¥ì•  ì¡°ì¹˜ ë˜ëŠ” ë¶„ë¦¬ í—ˆìš©í•˜ì§€ ì•ŠìŒ Heartbeat ë˜ëŠ” Pacemaker ì™€ ê°™ì€ HA(ê³ ê°€ìš©ì„±) ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°±ì—”ë“œë¥¼ ë³´í˜¸í•  ë•Œ ìœ ìš©í•©ë‹ˆë‹¤ . ALLOW_TO_FAILOVERì™€ ë™ì‹œì— ì§€ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
. `'ALWAYS_PRIMARY'` : 	ìŠ¤íŠ¸ë¦¬ë° ë³µì œ ëª¨ë“œì—ì„œë§Œ ìœ ìš©í•©ë‹ˆë‹¤. í”Œë˜ê·¸ê°€ ì„¤ì •ëœ ë…¸ë“œë¥¼ í•­ìƒ Primary ë…¸ë“œë¡œ ê°„ì£¼í•©ë‹ˆë‹¤.

* *backend_application_name[n] = '[IP]]'*
** Primary ë…¸ë“œì—ì„œ WAL ë¡œê·¸ë¥¼ ìˆ˜ì‹ í•˜ëŠ” walreceiverì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ë¦„ì„ ì§€ì •í•©ë‹ˆë‹¤.
** *SHOW POOL NODES* ë° *pcp_node_info* ëª…ë ¹ ì—ì„œ "replication_state" ë° "replication_sync_state" ì—´ì„ í‘œì‹œí•˜ë ¤ë©´ ì´ ë§¤ê°œë³€ìˆ˜ê°€ í•„ìš” í•©ë‹ˆë‹¤.
** Standby nodeê°€ backend1 ì´ê³   backend1ì— ëŒ€í•œ backend_application_nameì´ "server1"ì´ë¼ê³  ê°€ì •í•˜ë©´ postgresql.conf ì˜ primary_conninfo ë§¤ê°œë³€ìˆ˜ëŠ” ë‹¤ìŒ ê³¼ ê°™ì•„ì•¼ í•©ë‹ˆë‹¤.
----
primary_conninfo = 'host=[Primary IP] port=5432 user=postgres application_name='[Standby IP]''
----


   ğŸ’¡ Backend Connection Settingsì˜ ê° íŒŒë¼ë¯¸í„°ì— ìƒˆ íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ê°€í•œ í›„ config íŒŒì¼ì„ reload í•˜ë©´ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

   ğŸ’¡ ê¸°ì¡´ê°’ì„ ì—…ë°ì´íŠ¸ í•˜ë ¤ë©´ pgpool-II ì„ restart í•´ì•¼í•©ë‹ˆë‹¤.


==== Authentication Settings
----
# - Authentication -
enable_pool_hba = on
----
*  *enable_pool_hba = on*

** `on` ì´ë©´ Pgpool-II ëŠ” í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ì„ ìœ„í•´ pool_hba.conf ë¥¼ ì‚¬ìš© í•©ë‹ˆë‹¤.
** default = off
** ê¸°ì¡´ê°’ì„ ì—…ë°ì´íŠ¸ í•˜ë ¤ë©´ pgpool-II ì„ restart í•´ì•¼í•©ë‹ˆë‹¤.

==== Logs Settings
----
#------------------------------------------------------------------------------
# LOGS
#------------------------------------------------------------------------------

# - Where to log -

log_destination = 'stderr'

# This is used when logging to stderr:

logging_collector = on

# -- Only used if logging_collector is on ---

log_directory = '/hypersql/pg/14/log/pgpool'
log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log'
log_truncate_on_rotation = on
log_rotation_age = 1d
log_rotation_size = 10MB
----

*  *log_destination = 'stderr'*
** default = 'stderr'
** Pgpool-II ë©”ì‹œì§€ ë¥¼ ê¸°ë¡í•˜ê¸° ìœ„í•œ ë‘ ê°€ì§€ ëŒ€ìƒì„ ì§€ì› í•©ë‹ˆë‹¤. ì§€ì›ë˜ëŠ” ë¡œê·¸ ëŒ€ìƒì€ `stderr` ë° `syslog` ì…ë‹ˆë‹¤. 
** ì—¬ëŸ¬ ëŒ€ìƒì— ëŒ€í•œ ë¡œê·¸ ë©”ì‹œì§€ë¥¼ ì›í•˜ëŠ” ê²½ìš° ì´ ë§¤ê°œë³€ìˆ˜ë¥¼ ì‰¼í‘œë¡œ êµ¬ë¶„ëœ ì›í•˜ëŠ” ë¡œê·¸ ëŒ€ìƒ ëª©ë¡ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
----
       log_destination = 'syslog,stderr'
----

*  *logging_collector = on*
** stderrë¡œ ì „ì†¡ëœ ë¡œê·¸ ë©”ì‹œì§€ë¥¼ ìº¡ì²˜í•˜ê³  ë¡œê·¸ íŒŒì¼ë¡œ ë¦¬ë””ë ‰ì…˜í•˜ëŠ” ë°±ê·¸ë¼ìš´ë“œ í”„ë¡œì„¸ìŠ¤ì¸ ë¡œê¹… ìˆ˜ì§‘ê¸°ë¥¼ í™œì„±í™”í•©ë‹ˆë‹¤.
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì— ì„¤ì •í•´ì•¼í•©ë‹ˆë‹¤.

*  *log_directory = '/hypersql/pg/14/log/pgpool'*
** default = '/tmp/pgpool_logs'
** logging_collectorê°€ í™œì„±í™”ë˜ë©´ ì´ ë§¤ê°œë³€ìˆ˜ëŠ” ë¡œê·¸ íŒŒì¼ì´ ìƒì„±ë  ë””ë ‰í† ë¦¬ë¥¼ ê²°ì •í•©ë‹ˆë‹¤.
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì— ì„¤ì •í•´ì•¼í•©ë‹ˆë‹¤.

*  *log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log'*
** default = 'pgpool-%Y-%m-%d_%H%M%S.log'
** logging_collector ê°€ í™œì„±í™”ëœ ê²½ìš° ì´ ë§¤ê°œë³€ìˆ˜ëŠ” ìƒì„±ëœ ë¡œê·¸ íŒŒì¼ì˜ íŒŒì¼ ì´ë¦„ì„ ì„¤ì •í•©ë‹ˆë‹¤.
** strftime íŒ¨í„´ìœ¼ë¡œ ì²˜ë¦¬ë˜ë¯€ë¡œ %-escapeë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹œê°„ì— ë”°ë¼ ë³€í•˜ëŠ” íŒŒì¼ ì´ë¦„ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì— ì„¤ì •í•´ì•¼í•©ë‹ˆë‹¤.

*  *log_truncate_on_rotation = on*
** logging_collector ê°€ í™œì„±í™” ë˜ë©´ ì´ ë§¤ê°œë³€ìˆ˜ëŠ” Pgpool-II ê°€ ë™ì¼í•œ ì´ë¦„ì˜ ê¸°ì¡´ ë¡œê·¸ íŒŒì¼ì— ì¶”ê°€í•˜ì§€ ì•Šê³  ìë¥´ê¸°(ë®ì–´ì“°ê¸°)í•˜ë„ë¡ í•©ë‹ˆë‹¤. 
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì— ì„¤ì •í•´ì•¼í•©ë‹ˆë‹¤.


*  *log_rotation_age = 1d*
** default = 1d
** logging_collector ê°€ í™œì„±í™” ë˜ë©´ ì´ ë§¤ê°œë³€ìˆ˜ëŠ” ê°œë³„ ë¡œê·¸ íŒŒì¼ì„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìµœëŒ€ ì‹œê°„ì„ ê²°ì •í•˜ê³  ì´í›„ì— ìƒˆ ë¡œê·¸ íŒŒì¼ì´ ìƒì„±ë©ë‹ˆë‹¤. ì´ ê°’ì´ ë‹¨ìœ„ ì—†ì´ ì§€ì •ë˜ë©´ ë¶„ìœ¼ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤. 
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì— ì„¤ì •í•´ì•¼í•©ë‹ˆë‹¤.

*  *log_rotation_size = 10MB*
** logging_collector ê°€ í™œì„±í™” ë˜ë©´ ì´ ë§¤ê°œë³€ìˆ˜ëŠ” ê°œë³„ ë¡œê·¸ íŒŒì¼ì˜ ìµœëŒ€ í¬ê¸°ë¥¼ ê²°ì •í•©ë‹ˆë‹¤.
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì— ì„¤ì •í•´ì•¼í•©ë‹ˆë‹¤.

==== Pid File Location Settings
----
#------------------------------------------------------------------------------
# FILE LOCATIONS
#------------------------------------------------------------------------------

pid_file_name = '/var/run/hypersql/pgpool.pid'
----

* *pid_file_name = '/var/run/hypersql/pgpool.pid'*
** default =  "/var/run/pgpool/pgpool.pid"
** Pgpool-II í”„ë¡œì„¸ìŠ¤ ID ë¥¼ ì €ì¥í•  íŒŒì¼ì˜ ì „ì²´ ê²½ë¡œë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì— ì„¤ì •í•´ì•¼í•©ë‹ˆë‹¤.

==== Streaming Replication Mode Settings
. Pgpool-II ëŠ” PostgreSQL 9.0 ë¶€í„° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” PostgreSQL ê¸°ë³¸ ìŠ¤íŠ¸ë¦¬ë° ë³µì œ ì™€ í•¨ê»˜ ì‘ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìŠ¤íŠ¸ë¦¬ë° ë³µì œë¡œ Pgpool-II ë¥¼ êµ¬ì„±í•˜ë ¤ë©´ backend_clustering_mode ë¥¼ `'streaming-replication'` ìœ¼ë¡œ ì„¤ì • í•©ë‹ˆë‹¤.
. Pgpool-II ëŠ” ìŠ¤íŠ¸ë¦¬ë° ë³µì œê°€ PostgreSQLì˜ Hot Standbyë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤. ì¦‰, ëŒ€ê¸° ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì½ê¸° ì „ìš© ì¿¼ë¦¬ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
----
#------------------------------------------------------------------------------
# STREAMING REPLICATION MODE
#------------------------------------------------------------------------------

# - Streaming -

sr_check_period = 10                       
sr_check_user = 'postgres'                  
sr_check_password = ''                     
sr_check_database = 'postgres'    
----
* *sr_check_period = 10*       
** default =  10
** ìŠ¤íŠ¸ë¦¬ë° ë³µì œ ì§€ì—°ì„ í™•ì¸í•˜ëŠ” ì‹œê°„ ê°„ê²©(ì´ˆ)ì„ ì§€ì •í•©ë‹ˆë‹¤. 
** ì´ íŒŒë¼ë¯¸í„°ëŠ” pgpool-II config íŒŒì¼ì„ reloadí•˜ì—¬ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* *sr_check_user = 'postgres'*     
** ìŠ¤íŠ¸ë¦¬ë° ë³µì œ ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•  PostgreSQL ì‚¬ìš©ì ì´ë¦„ì„ ì§€ì •í•©ë‹ˆë‹¤. 
** ì‚¬ìš©ìëŠ” LOGIN ê¶Œí•œì´ ìˆì–´ì•¼ í•˜ë©° ëª¨ë“  PostgreSQL ë°±ì—”ë“œì— ì¡´ì¬í•´ì•¼ í•©ë‹ˆë‹¤.
** ì´ íŒŒë¼ë¯¸í„°ëŠ” pgpool-II config íŒŒì¼ì„ reloadí•˜ì—¬ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* *sr_check_password = ''*             
** ìŠ¤íŠ¸ë¦¬ë° ë³µì œ ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•  `sr_check_user` PostgreSQL ì‚¬ìš©ì ì˜ ì•”í˜¸ë¥¼ ì§€ì • í•©ë‹ˆë‹¤. ì‚¬ìš©ìì—ê²Œ ì•”í˜¸ê°€ í•„ìš”í•˜ì§€ ì•Šì€ ê²½ìš° '' (ë¹ˆ ë¬¸ìì—´)ë¥¼ ì‚¬ìš© í•©ë‹ˆë‹¤.
** sr_check_password ê°€ ë¹„ì–´ ìˆìœ¼ë©´ Pgpool-II ëŠ” ë¹ˆ ì•”í˜¸ë¥¼ ì‚¬ìš©í•˜ê¸° ì „ì— ë¨¼ì € pool_passwd íŒŒì¼ ì—ì„œ sr_check_user ì˜ ì•”í˜¸ë¥¼ ì–»ìœ¼ë ¤ê³  ì‹œë„ í•©ë‹ˆë‹¤.
** Pgpool-II ëŠ” sr_check_password ë˜ëŠ” pool_passwd íŒŒì¼ ì—ì„œ ë‹¤ìŒ í˜•ì‹ì˜ ì•”í˜¸ë¥¼ í—ˆìš© í•©ë‹ˆë‹¤.
*** AES256-CBC encrypted password
*** MD5 hashed password
*** Plain text password
** ì´ íŒŒë¼ë¯¸í„°ëŠ” pgpool-II config íŒŒì¼ì„ reloadí•˜ì—¬ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* *sr_check_database = 'postgres'*    
** default = 'postgres'
** ìŠ¤íŠ¸ë¦¬ë° ë³µì œ ì§€ì—° ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•  ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì§€ì •í•©ë‹ˆë‹¤. 
** ì´ íŒŒë¼ë¯¸í„°ëŠ” pgpool-II config íŒŒì¼ì„ reloadí•˜ì—¬ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

==== Follow Primary Command Settings
----

# - Special commands -

follow_primary_command = '/etc/pgpool-II/follow_primary.sh %d %h %p %D %m %H %M %P %r %R'         
----
* *follow_primary_command = '/etc/pgpool-II/follow_primary.sh %d %h %p %D %m %H %M %P %r %R'*
** Primary ë…¸ë“œ failover í›„ ì‹¤í–‰í•  ì‚¬ìš©ì ëª…ë ¹ì„ ì§€ì •í•©ë‹ˆë‹¤. Standby ë…¸ë“œ failoverì˜ ê²½ìš° ëª…ë ¹ì´ ì‹¤í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. 
** ì´ ëª…ë ¹ì€ `pcp_promote_node` ëª…ë ¹ ì— ì˜í•´ ë…¸ë“œ ìŠ¹ê²© ìš”ì²­ì´ ë°œí–‰ëœ ê²½ìš°ì—ë„ ì‹¤í–‰ë©ë‹ˆë‹¤ . ì´ê²ƒì€ ìŠ¤íŠ¸ë¦¬ë° ë³µì œ ëª¨ë“œì—ì„œë§Œ ì‘ë™í•©ë‹ˆë‹¤.
** PostgreSQL ì„œë²„ê°€ 2ëŒ€ì¸ ê²½ìš°ì—ëŠ” follow_primary_command ì„¤ì •ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

==== Health Check Settings
. Pgpool-II ëŠ” êµ¬ì„±ëœ PostgreSQL ë°±ì—”ë“œì— ì£¼ê¸°ì ìœ¼ë¡œ ì—°ê²°í•˜ì—¬ ì„œë²„ ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ì˜ ì˜¤ë¥˜ë¥¼ ê°ì§€í•©ë‹ˆë‹¤. ì´ ì˜¤ë¥˜ ê²€ì‚¬ ì ˆì°¨ë¥¼ "health check"ë¼ê³  í•©ë‹ˆë‹¤. 
. ì˜¤ë¥˜ê°€ ê°ì§€ë˜ë©´ Pgpool-II ëŠ” êµ¬ì„±ì— ë”°ë¼ ì¥ì•  ì¡°ì¹˜(failover) ë˜ëŠ” í‡´í™”(degeneration)ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.
. health check í”„ë¡œì„¸ìŠ¤ëŠ” ì´ health check íšŸìˆ˜ ë“± ë‹¤ì–‘í•œ í†µê³„ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤. í†µê³„ ë°ì´í„°ë¥¼ ê²€ì‚¬í•˜ë ¤ë©´ SHOW POOL_HEALTH_CHECK_STATS ëª…ë ¹ì„ ì‚¬ìš©í•˜ì‹­ì‹œì˜¤. ë°ì´í„°ëŠ” ê³µìœ  ë©”ëª¨ë¦¬ ì˜ì—­ì— ì €ì¥ë˜ë©° Pgpool-II ê°€ ì‹œì‘ë  ë•Œ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.
. ë‹¤ìŒ ë§¤ê°œë³€ìˆ˜ ì´ë¦„ì€ ê° ì´ë¦„ ëì— node idë¥¼ ê°€ì§ˆ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì ‘ë¯¸ì‚¬ê°€ ì—†ëŠ” ë§¤ê°œë³€ìˆ˜ ì´ë¦„ì€ "ì „ì—­ ë³€ìˆ˜"ì²˜ëŸ¼ ì‘ë™í•©ë‹ˆë‹¤.
.. ë°±ì—”ë“œ ë…¸ë“œ 0ì˜ health_check_timeoutì€ health_check_timeout0 ì…ë‹ˆë‹¤.

----
#------------------------------------------------------------------------------
# HEALTH CHECK PER NODE PARAMETERS (OPTIONAL)
#------------------------------------------------------------------------------

health_check_period = 10                   
health_check_timeout = 20                   
health_check_user = 'postgres'              
health_check_password = ''                  
health_check_database = 'postgres'          
health_check_max_retries = 3                
----
* *health_check_period = 10*    
** default = 0 (ë¹„í™œì„±í™”)
** ìƒíƒœ í™•ì¸ ì‚¬ì´ì˜ ê°„ê²©ì„ ì´ˆ ë‹¨ìœ„ë¡œ ì§€ì •í•©ë‹ˆë‹¤.
** ì´ íŒŒë¼ë¯¸í„°ëŠ” pgpool-II config íŒŒì¼ì„ reloadí•˜ì—¬ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* *health_check_timeout = 20*                   
** default = 20
** TCP ì—°ê²°ì´ ì´ ì‹œê°„ ë‚´ì— ì„±ê³µí•˜ì§€ ëª»í•œ ê²½ìš° ë°±ì—”ë“œ PostgreSQL ì—°ê²°ì„ í¬ê¸°í•  ì‹œê°„ ì œí•œì„ ì´ˆ ë‹¨ìœ„ë¡œ ì§€ì •í•©ë‹ˆë‹¤.
** ì´ íŒŒë¼ë¯¸í„°ëŠ” pgpool-II config íŒŒì¼ì„ reloadí•˜ì—¬ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* *health_check_user = 'postgres'*
** ìƒíƒœ í™•ì¸ì„ ìˆ˜í–‰í•  PostgreSQL ì‚¬ìš©ì ì´ë¦„ì„ ì§€ì •í•©ë‹ˆë‹¤. ëª¨ë“  PostgreSQL ë°±ì—”ë“œ ì— ë™ì¼í•œ ì‚¬ìš©ìê°€ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. 
** ì´ íŒŒë¼ë¯¸í„°ëŠ” pgpool-II config íŒŒì¼ì„ reloadí•˜ì—¬ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* *health_check_password = ''*     
** ìƒíƒœ í™•ì¸ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ health_check_user ì— êµ¬ì„±ëœ PostgreSQL ì‚¬ìš©ì ì´ë¦„ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì§€ì •í•©ë‹ˆë‹¤. ì‚¬ìš©ìì™€ ë¹„ë°€ë²ˆí˜¸ëŠ” ëª¨ë“  PostgreSQL ë°±ì—”ë“œì—ì„œ ë™ì¼í•´ì•¼ í•©ë‹ˆë‹¤. 
** health_check_password ê°€ ë¹„ì–´ ìˆëŠ” ê²½ìš° Pgpool-II ëŠ” ë¹ˆ ì•”í˜¸ë¥¼ ì‚¬ìš©í•˜ê¸° ì „ì— ë¨¼ì € pool_passwd íŒŒì¼ ì—ì„œ health_check_user ì˜ ì•”í˜¸ë¥¼ ì–»ìœ¼ë ¤ê³  ì‹œë„ í•©ë‹ˆë‹¤.
** Pgpool-II ëŠ” health_check_password ë˜ëŠ” pool_passwd íŒŒì¼ ì—ì„œ ë‹¤ìŒ í˜•ì‹ì˜ ì•”í˜¸ë¥¼ í—ˆìš© í•©ë‹ˆë‹¤.
*** AES256-CBC encrypted password
*** MD5 hashed password
*** Plain text password
** ì´ íŒŒë¼ë¯¸í„°ëŠ” pgpool-II config íŒŒì¼ì„ reloadí•˜ì—¬ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* *health_check_database = 'postgres'*      
** default = '' ("postgres" ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë¨¼ì € ì‹œë„í•œ ë‹¤ìŒ ì„±ê³µí•  ë•Œê¹Œì§€ "template1" ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‹œë„)
** ìƒíƒœ í™•ì¸ì„ ìˆ˜í–‰í•  PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ ì´ë¦„ì„ ì§€ì •í•©ë‹ˆë‹¤.
** ì´ íŒŒë¼ë¯¸í„°ëŠ” pgpool-II config íŒŒì¼ì„ reloadí•˜ì—¬ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* *health_check_max_retries = 3*
** default = 0 (ì¬ì‹œë„ í•˜ì§€ì•ŠìŒ)
** health_checkë¥¼ ì‹¤íŒ¨í•˜ë©´ í¬ê¸°í•˜ê³  ì¥ì•  ì¡°ì¹˜ë¥¼ ì‹œì‘í•˜ê¸° ì „ì— ìˆ˜í–‰í•  ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
** health Checkì— ì‹¤íŒ¨í•˜ì—¬ ì¥ì•  ì¡°ì¹˜(failover) ë˜ëŠ” í‡´í™”(degenerate) ì‘ì—…ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì˜ëª»ëœ ìƒíƒœ í™•ì¸ ê°ì§€ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ `health_check_max_retries` = 3 ìœ¼ë¡œ ì„¤ì • í•©ë‹ˆë‹¤
** ì´ íŒŒë¼ë¯¸í„°ëŠ” pgpool-II config íŒŒì¼ì„ reloadí•˜ì—¬ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

   ğŸ’¡ `health_check_max_retries` ë¥¼ í™œì„±í™”í•˜ë ¤ë©´ `failover_on_backend_error` ë¥¼ ë¹„í™œì„±í™” í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤ .


==== Failover Command Settings
----
#------------------------------------------------------------------------------
# FAILOVER AND FAILBACK
#------------------------------------------------------------------------------

failover_command = '/etc/pgpool-II/failover.sh %d %h %p %D %m %M %H %P %r %R'
                                   # Executes this command at failover
----
* *failover_command = '/etc/pgpool-II/failover.sh %d %h %p %D %m %M %H %P %r %R'*
** `failover_command` ê°€ ì„¤ì •ë˜ì–´ ìˆê³  failoverê°€ ë°œìƒí•˜ë©´ `failover_command` ê°€ ì‹¤í–‰ëœë‹¤. `failover_command` ëŠ” ì‚¬ìš©ìê°€ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤. 
** Pgpool-II ëŠ” ë‹¤ìŒ íŠ¹ìˆ˜ ë¬¸ìë¥¼ ë°±ì—”ë“œ íŠ¹ì • ì •ë³´ë¡œ ë°”ê¿‰ë‹ˆë‹¤.

[width="70%", options="header",cols="0,2"]
|========================
|%d | Detachëœ DB node ID
|%h | Detachëœ Nodeì˜ Hostname
|%p | Detachëœ Nodeì˜ Port ë²ˆí˜¸
|%D | Detachëœ Nodeì˜ Database cluster ë””ë ‰í† ë¦¬
|%m | ìƒˆë¡œìš´ main nodeì˜ ID
|%H | ìƒˆë¡œìš´ main nodeì˜ ID
|%M | ì´ì „ main node ID
|%P | ì´ì „ primary node ID
|%r | ìƒˆë¡œìš´ main nodeì˜ Port ë²ˆí˜¸
|%R |  ìƒˆë¡œìš´ nodeì˜ Database cluster directory
|%N | Hostname of the old primary node (Pgpool-II 4.1 or after)
|%S | Port number of the old primary node (Pgpool-II 4.1 or after)
|%% | '%' character
|========================

==== Online Recovery Settings
----
#------------------------------------------------------------------------------
# ONLINE RECOVERY
#------------------------------------------------------------------------------

recovery_user = 'postgres'
recovery_password = ''
recovery_timeout = 90
recovery_1st_stage_command = 'basebackup.sh'
load_balance_mode = on
----

* *recovery_user = 'postgres'*
** ì˜¨ë¼ì¸ ë³µêµ¬ë¥¼ ìˆ˜í–‰í•  PostgreSQL ì‚¬ìš©ì ì´ë¦„ì„ ì§€ì •í•©ë‹ˆë‹¤.
** ì´ íŒŒë¼ë¯¸í„°ëŠ” pgpool-II config íŒŒì¼ì„ reloadí•˜ì—¬ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* *recovery_password = ''*
** ì˜¨ë¼ì¸ ë³µêµ¬ë¥¼ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ recovery_user ì— êµ¬ì„±ëœ PostgreSQL ì‚¬ìš©ì ì´ë¦„ ì˜ ì•”í˜¸ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
** `recovery_password` ê°€ ë¹„ì–´ ìˆìœ¼ë©´ Pgpool-II ëŠ” ë¹ˆ ì•”í˜¸ë¥¼ ì‚¬ìš©í•˜ê¸° ì „ì— ë¨¼ì € pool_passwd íŒŒì¼ ì—ì„œ `recovery_user` ì— ëŒ€í•œ ì•”í˜¸ë¥¼ ì–»ìœ¼ë ¤ê³  ì‹œë„ í•©ë‹ˆë‹¤.
** ì´ íŒŒë¼ë¯¸í„°ëŠ” pgpool-II config íŒŒì¼ì„ reloadí•˜ì—¬ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* *recovery_timeout = 90*
** ì´ ì‹œê°„ ë‚´ì— ì™„ë£Œë˜ì§€ ì•Šìœ¼ë©´ ì˜¨ë¼ì¸ ë³µêµ¬ë¥¼ ì·¨ì†Œí•  ì‹œê°„ ì œí•œ(ì´ˆ)ì„ ì§€ì •í•©ë‹ˆë‹¤.
** ì´ íŒŒë¼ë¯¸í„°ëŠ” pgpool-II config íŒŒì¼ì„ reloadí•˜ì—¬ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* *recovery_1st_stage_command = 'basebackup.sh'*
** ì˜¨ë¼ì¸ ë³µêµ¬ì˜ ì²« ë²ˆì§¸ ë‹¨ê³„ì—ì„œ ê¸°ë³¸(ê¸°ë³¸) ë…¸ë“œì—ì„œ ì‹¤í–‰í•  ëª…ë ¹ì„ ì§€ì •í•©ë‹ˆë‹¤. ëª…ë ¹ íŒŒì¼ì€ ë³´ì•ˆìƒì˜ ì´ìœ ë¡œ ë°ì´í„°ë² ì´ìŠ¤ í´ëŸ¬ìŠ¤í„° ë””ë ‰í† ë¦¬ì— ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
** ì´ íŒŒë¼ë¯¸í„°ëŠ” pgpool-II config íŒŒì¼ì„ reloadí•˜ì—¬ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* *load_balance_mode = on*
** default = on
** onìœ¼ë¡œ ì„¤ì •í•˜ë©´ Pgpool-II ê°€ ë“¤ì–´ì˜¤ëŠ” SELECT ì¿¼ë¦¬ ì—ì„œ ë¡œë“œ ë°¸ëŸ°ì‹±ì„ í™œì„±í™” í•©ë‹ˆë‹¤. ì¦‰ , í´ë¼ì´ì–¸íŠ¸ì˜ SELECT ì¿¼ë¦¬ê°€ êµ¬ì„±ëœ PostgreSQL ë°±ì—”ë“œë¡œ ë°°í¬ë©ë‹ˆë‹¤. 
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì—ë§Œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

==== Watchdog Settings
----
#------------------------------------------------------------------------------
# WATCHDOG
#------------------------------------------------------------------------------

# - Enabling -

use_watchdog = on
                                    # Activates watchdog
                                    # (change requires restart)


# - Watchdog communication Settings -

hostname0 = '[primary IP]'
wd_port0 = 9000
pgpool_port0 = 9999

hostname1 = '[standby IP]'
wd_port1 = 9000
pgpool_port1 = 9999

wd_ipc_socket_dir = '/var/run/hypersql'
                                    # Unix domain socket path for watchdog IPC socket
                                    # The Debian package defaults to
                                    # /var/run/postgresql
----

* *use_watchdog = on*
** default = off
** ì¼œì ¸ìˆìœ¼ë©´ watchdogì„ í™œì„±í™”í•©ë‹ˆë‹¤.
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì—ë§Œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

   ğŸ’¡ [n]ì— ë“¤ì–´ê°ˆ ìˆ«ìëŠ” node id ì…ë‹ˆë‹¤.

* *hostname[n] = '[IP]'*
** Pgpool-II ì„œë²„ ì˜ í˜¸ìŠ¤íŠ¸ ì´ë¦„ ë˜ëŠ” IP ì£¼ì†Œë¥¼ ì§€ì • í•©ë‹ˆë‹¤.
** ì¿¼ë¦¬ ë° íŒ¨í‚·ì„ ì†¡ìˆ˜ì‹ í•˜ëŠ” ë° ì‚¬ìš©ë˜ë©° watchdog ë…¸ë“œì˜ ì‹ë³„ìë¡œë„ ì‚¬ìš©ë©ë‹ˆë‹¤. 
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì—ë§Œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* *wd_port[n] = 9000*
** default = 9000
** ê°ì‹œ í”„ë¡œì„¸ìŠ¤ê°€ ì—°ê²°ì„ ìˆ˜ì‹  ëŒ€ê¸°í•˜ëŠ” ë° ì‚¬ìš©í•  í¬íŠ¸ ë²ˆí˜¸ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì—ë§Œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* *pgpool_port[n]] = 9999*
** default = 9999
** Pgpool-II í¬íŠ¸ ë²ˆí˜¸ë¥¼ ì§€ì •í•©ë‹ˆë‹¤ . 
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì—ë§Œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* *wd_ipc_socket_dir = '/var/run/hypersql'*
** default = '/tmp'
** Pgpool-II watchdog IPC ì—°ê²°ì„ ìˆ˜ë½í•˜ëŠ” UNIX ë„ë©”ì¸ ì†Œì¼“ ì´ ìƒì„±ë  ë””ë ‰í„°ë¦¬ ì…ë‹ˆë‹¤. 
** ì´ ê°’ì„ '/var/run' ë˜ëŠ” ê·¸ëŸ¬í•œ ë””ë ‰í† ë¦¬ë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
** `wd_ipc_socket_dir` ì€ Pgpool-II V3.5 ì´ì „ ë²„ì „ì—ì„œëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
** ì´ ë§¤ê°œë³€ìˆ˜ëŠ” ì„œë²„ ì‹œì‘ ì‹œì—ë§Œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

==== Virtual IP Control Settings
----
# - Virtual IP control Setting -

delegate_IP = '[virtual IP]'
                                    # delegate IP address
                                    # If this is empty, virtual IP never bring up.
if_cmd_path = '/sbin'
                                    # path to the directory where if_up/down_cmd exists
                                    # If if_up/down_cmd starts with "/", if_cmd_path will be ignored.
if_up_cmd = '/usr/bin/sudo /sbin/ip addr add $_IP_$/24 dev [network device] label [virtual network device]'
                                    # startup delegate IP command
if_down_cmd = '/usr/bin/sudo /sbin/ip addr del $_IP_$/24 dev [network device]'
                                    # shutdown delegate IP command
arping_path = '/usr/sbin'
                                    # arping command path
                                    # If arping_cmd starts with "/", if_cmd_path will be ignored.
arping_cmd = '/usr/bin/sudo /usr/sbin/arping -U $_IP_$ -w 1 -I [network device]'
                                    # arping command
----
* *delegate_IP = '[virtual IP]'*
** default = '' (ê°€ìƒIPê°€ í‘œì‹œë˜ì§€ì•ŠìŒ)
** í´ë¼ì´ì–¸íŠ¸ ì„œë²„(ì‘ìš© ì„œë²„ ë“±)ì—ì„œ ì—°ê²°ë˜ëŠ” Pgpool-II ì˜ ê°€ìƒ IP ì£¼ì†Œ(VIP)ë¥¼ ì§€ì •í•©ë‹ˆë‹¤ .
** Pgpool-II ê°€ ëŒ€ê¸°ì—ì„œ í™œì„±ìœ¼ë¡œ ì „í™˜ë˜ë©´ Pgpool -IIê°€ ì´ VIPë¥¼ ì¸ìˆ˜í•©ë‹ˆë‹¤. quorumì´ ì¡´ì¬ í•˜ì§€ ì•ŠëŠ” ê²½ìš° VIP ê°€ ë‚˜íƒ€ë‚˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

* *if_cmd_path = '/sbin'*
** Pgpool-II ê°€ ì‹œìŠ¤í…œì˜ ê°€ìƒ IPë¥¼ ì „í™˜í•˜ëŠ” ë° ì‚¬ìš©í•  ëª…ë ¹ì˜ ê²½ë¡œë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
** if_up_cmd ë˜ëŠ” if_down_cmd ê°€ "/"ë¡œ ì‹œì‘í•˜ëŠ” ê²½ìš° ì´ ë§¤ê°œë³€ìˆ˜ëŠ” ë¬´ì‹œë©ë‹ˆë‹¤.
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì—ë§Œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* *if_up_cmd = '/usr/bin/sudo /sbin/ip addr add $_IP_$/24 dev [network device] label [virtual network device]'*
** ê°€ìƒ IPë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ëª…ë ¹ì„ ì§€ì •í•©ë‹ˆë‹¤.
** ì´ ëª…ë ¹ì„ ì‹¤í–‰í•˜ë ¤ë©´ ë£¨íŠ¸ ê¶Œí•œì´ í•„ìš”í•˜ë¯€ë¡œ ip ëª…ë ¹ì—ì„œ setuid ë¥¼ ì‚¬ìš© í•˜ê±°ë‚˜ Pgpool-II ì‹œì‘ ì‚¬ìš©ì(ê¸°ë³¸ì ìœ¼ë¡œ hypersql ì‚¬ìš©ì) ê°€ ì•”í˜¸ ì—†ì´ sudo ëª…ë ¹ì„ ì‹¤í–‰í•˜ë„ë¡ í—ˆìš©í•˜ê³  "/usr/bin/sudo /sbin" ê³¼ ê°™ì´ ì§€ì •í•©ë‹ˆë‹¤.
** `$_IP_$`ëŠ” `delegate_IP` ì— ì§€ì •ëœ IP ì£¼ì†Œë¡œ ëŒ€ì²´ë©ë‹ˆë‹¤ .
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì—ë§Œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* *if_down_cmd = '/usr/bin/sudo /sbin/ip addr del $_IP_$/24 dev [network device]'*
** ê°€ìƒ IPë¥¼ ì¤‘ë‹¨í•˜ëŠ” ëª…ë ¹ì„ ì§€ì •í•©ë‹ˆë‹¤. 
** ì´ ëª…ë ¹ì„ ì‹¤í–‰í•˜ë ¤ë©´ ë£¨íŠ¸ ê¶Œí•œì´ í•„ìš”í•˜ë¯€ë¡œ ip ëª…ë ¹ì—ì„œ setuid ë¥¼ ì‚¬ìš© í•˜ê±°ë‚˜ Pgpool-II ì‹œì‘ ì‚¬ìš©ì(ê¸°ë³¸ì ìœ¼ë¡œ hypersql ì‚¬ìš©ì) ê°€ ì•”í˜¸ ì—†ì´ sudo ëª…ë ¹ì„ ì‹¤í–‰í•˜ë„ë¡ í—ˆìš©í•˜ê³  "/usr/bin/sudo /sbin" ê³¼ ê°™ì´ ì§€ì •í•©ë‹ˆë‹¤.
** `$_IP_$`ëŠ” `delegate_IP` ì— ì§€ì •ëœ IP ì£¼ì†Œë¡œ ëŒ€ì²´ë©ë‹ˆë‹¤ .
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì—ë§Œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* *arping_path = '/usr/sbin'*
** Pgpool-II ê°€ ê°€ìƒ IP ì „í™˜ í›„ ARP ìš”ì²­ì„ ë³´ë‚´ëŠ” ë° ì‚¬ìš©í•  ëª…ë ¹ì˜ ê²½ë¡œë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
** arping_cmd ê°€ "/"ë¡œ ì‹œì‘ í•˜ë©´ ì´ ë§¤ê°œë³€ìˆ˜ëŠ” ë¬´ì‹œë©ë‹ˆë‹¤.
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì—ë§Œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* *arping_cmd = '/usr/bin/sudo /usr/sbin/arping -U $_IP_$ -w 1 -I [network device]'*
** ê°€ìƒ IP ì „í™˜ í›„ ARP ìš”ì²­ì„ ë³´ë‚´ëŠ” ë° ì‚¬ìš©í•  ëª…ë ¹ì„ ì§€ì •í•©ë‹ˆë‹¤. 
** ì´ ëª…ë ¹ì„ ì‹¤í–‰í•˜ë ¤ë©´ ë£¨íŠ¸ ê¶Œí•œì´ í•„ìš”í•˜ë¯€ë¡œ ip ëª…ë ¹ì—ì„œ setuid ë¥¼ ì‚¬ìš© í•˜ê±°ë‚˜ Pgpool-II ì‹œì‘ ì‚¬ìš©ì(ê¸°ë³¸ì ìœ¼ë¡œ hypersql ì‚¬ìš©ì) ê°€ ì•”í˜¸ ì—†ì´ sudo ëª…ë ¹ì„ ì‹¤í–‰í•˜ë„ë¡ í—ˆìš©í•˜ê³  "/usr/bin/sudo /sbin" ê³¼ ê°™ì´ ì§€ì •í•©ë‹ˆë‹¤.
** `$_IP_$`ëŠ” `delegate_IP` ì— ì§€ì •ëœ IP ì£¼ì†Œë¡œ ëŒ€ì²´ë©ë‹ˆë‹¤ .
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì—ë§Œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


==== Escalation Settings
----
# - Behaivor on escalation Setting -

wd_escalation_command = '/etc/pgpool-II/escalation.sh'
----
* *wd_escalation_command = '/etc/pgpool-II/escalation.sh'*
** watchdogì€ leader watchdogìœ¼ë¡œ ì—ìŠ¤ì»¬ë ˆì´ì…˜ ëœ ë…¸ë“œì—ì„œ ì´ ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
** ì´ ëª…ë ¹ì€ Virtual IPë¥¼ ë¶ˆëŸ¬ì˜¤ê¸° ì§ì „ì— ì‹¤í–‰ë©ë‹ˆë‹¤.
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì—ë§Œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

==== Watchdog Consensus For Failover Settings 
----
# - Watchdog consensus settings for failover -

enable_consensus_with_half_votes = on
                                    # apply majority rule for consensus and quorum computation
                                    # at 50% of votes in a cluster with even number of nodes.
                                    # when enabled the existence of quorum and consensus
                                    # on failover is resolved after receiving half of the
                                    # total votes in the cluster, otherwise both these
                                    # decisions require at least one more vote than
                                    # half of the total votes.
----

* *enable_consensus_with_half_votes = on*
** default = off
** ì´ ë§¤ê°œë³€ìˆ˜ ëŠ” quorumì„ ê³„ì‚°í•˜ê³  failoverì— ëŒ€í•œ í•©ì˜ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ Pgpool-II ì—ì„œ ë‹¤ìˆ˜ ê·œì¹™ ê³„ì‚°ì„ ìˆ˜í–‰í•˜ëŠ” ë°©ë²•ì„ êµ¬ì„±í•©ë‹ˆë‹¤ .

   ğŸ’¡ ì´ íŒŒë¼ë¯¸í„°ëŠ” ë°±ì—”ë“œì˜ failover ë¿ë§Œì•„ë‹ˆë¼ pgpool-IIìì²´ì˜ failoverì—ë„ ì˜í–¥ì„ ì¤ë‹ˆë‹¤.

** í™œì„±í™”ëœ ê²½ìš° failoverì— ëŒ€í•œ quorum ë° í•©ì˜ì˜ ì¡´ì¬ì—ëŠ” í´ëŸ¬ìŠ¤í„°ì— êµ¬ì„±ëœ ì´ íˆ¬í‘œ ìˆ˜ì˜ ì ˆë°˜ë§Œ í•„ìš”í•©ë‹ˆë‹¤. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ì´ ë‘ ê²°ì • ëª¨ë‘ ì´ íˆ¬í‘œ ìˆ˜ì˜ ì ˆë°˜ë³´ë‹¤ ì ì–´ë„ í•œ í‘œ ë” ë§ì€ íˆ¬í‘œê°€ í•„ìš”í•©ë‹ˆë‹¤. 
** failoverì˜ ê²½ìš° ì´ ë§¤ê°œë³€ìˆ˜ëŠ” `failover_require_consensus` ì™€ í•¨ê»˜ ì‘ë™í•©ë‹ˆë‹¤ . 
** ì´ ë§¤ê°œë³€ìˆ˜ëŠ” watchdog í´ëŸ¬ìŠ¤í„°ê°€ ì§ìˆ˜ì˜ Pgpool-II ë…¸ë“œì— ëŒ€í•´ êµ¬ì„±ëœ ê²½ìš°ì—ë§Œ ì‘ë™í•©ë‹ˆë‹¤. 
** ì˜ˆë¥¼ ë“¤ì–´, ì´ ë§¤ê°œë³€ìˆ˜ê°€ 2ë…¸ë“œ watchdog í´ëŸ¬ìŠ¤í„°ì—ì„œ í™œì„±í™”ëœ ê²½ìš° quorumì´ ì¡´ì¬í•˜ë ¤ë©´ í•˜ë‚˜ì˜ Pgpool-II ë…¸ë“œê°€ í™œì„± ìƒíƒœì—¬ì•¼ í•©ë‹ˆë‹¤. ë§¤ê°œë³€ìˆ˜ê°€ êº¼ì ¸ ìˆìœ¼ë©´ ì¿¼ëŸ¼ì´ ì¡´ì¬í•˜ë ¤ë©´ ë‘ ê°œì˜ ë…¸ë“œê°€ í™œì„± ìƒíƒœì—¬ì•¼ í•©ë‹ˆë‹¤.
** pgpool-II V4.1 ì´ì „ì—ëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤ . ì´ì „ ë²„ì „ì€ ë§¤ê°œë³€ìˆ˜ê°€ ì¼œì ¸ ìˆëŠ” ê²ƒì²˜ëŸ¼ ì‘ë™í•©ë‹ˆë‹¤.
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì—ë§Œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

==== Lifecheck Settings 
. Watchdogì€ ì£¼ê¸°ì ìœ¼ë¡œ pgpool-II ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤. ì´ê²ƒì„ "Lifecheck" ë¼ê³  í•©ë‹ˆë‹¤.
----
# - Lifecheck Setting -
wd_lifecheck_method = 'heartbeat'
                                    # Method of watchdog lifecheck ('heartbeat' or 'query' or 'external')

wd_interval = 10
----
* *wd_lifecheck_method = 'heartbeat'*
** default = 'heartbeat'
** pgpool-II ìƒíƒœë¥¼ í™•ì¸í•˜ëŠ” lifecheck ë°©ë²•ì„ ì§€ì •í•©ë‹ˆë‹¤. ì•„ë˜ì™€ ê°™ì€ ë°©ë²•ì¤‘ì— í•˜ë‚˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
*** `heartbeat` : ì´ ëª¨ë“œì—ì„œ watchdogì€ ì£¼ê¸°ì ìœ¼ë¡œ heartbeat ì‹ í˜¸(UDP íŒ¨í‚·)ë¥¼ ë‹¤ë¥¸ Pgpool-II ë¡œ ë³´ëƒ…ë‹ˆë‹¤. ë§ˆì°¬ê°€ì§€ë¡œ watchdogì€ ë‹¤ë¥¸ Pgpool-II ë¡œë¶€í„° ì‹ í˜¸ë¥¼ ìˆ˜ì‹ í•©ë‹ˆë‹¤ . ì¼ì • ì‹œê°„ ë™ì•ˆ ì‹ í˜¸ê°€ ì—†ìœ¼ë©´ watchdogì€ Pgpool-II ì˜ ì‹¤íŒ¨ë¡œ ê°„ì£¼ í•©ë‹ˆë‹¤.

*** `query` : ì´ ëª¨ë“œì—ì„œ watchdogì€ ëª¨ë‹ˆí„°ë§ ì¿¼ë¦¬ë¥¼ ë‹¤ë¥¸ Pgpool-II ë¡œ ë³´ë‚´ê³  ì‘ë‹µì„ í™•ì¸í•©ë‹ˆë‹¤. Pgpool-II ì„œë²„ ê°„ì˜ ì„¤ì¹˜ ìœ„ì¹˜ê°€ ë¨¼ ê²½ìš° ì¿¼ë¦¬ ê°€ ìœ ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
*** `external` : ì´ ëª¨ë“œëŠ” Pgpool-II watchdogì˜ ê¸°ë³¸ ì œê³µ lifecheckë¥¼ ë¹„í™œì„±í™”í•˜ê³  ì™¸ë¶€ ì‹œìŠ¤í…œì— ì˜ì¡´í•˜ì—¬ ë¡œì»¬ ë° ì›ê²© watchdog ë…¸ë“œì˜ ë…¸ë“œ ìƒíƒœ ê²€ì‚¬ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

** Pgpool-II V3.5 ì´ì „ ë²„ì „ì—ì„œëŠ” external ëª¨ë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤ 
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì—ë§Œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* *wd_interval = 10*
** default = 10
** Pgpool-II ì˜ ìˆ˜ëª… ê²€ì‚¬ ê°„ê²© ì„ ì´ˆ ë‹¨ìœ„ë¡œ ì§€ì •í•©ë‹ˆë‹¤. (1 ì´ìƒì˜ ìˆ«ì) 
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì—ë§Œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

==== Heartbeat Mode Settings
----
# -- heartbeat mode --
heartbeat_hostname0 = '[primary IP]'
heartbeat_port0 = 9694
heartbeat_device0 = ''

heartbeat_hostname1 = '[standby IP]'
heartbeat_port1 = 9694
heartbeat_device1 = ''

wd_heartbeat_keepalive = 2
wd_heartbeat_deadtime = 30
----
   ğŸ’¡ [n]ì— ë“¤ì–´ê°ˆ ìˆ«ìëŠ” node id ì…ë‹ˆë‹¤.

* *heartbeat_hostname[n] = '[IP]'*
** heartbeat ì‹ í˜¸ë¥¼ ë³´ë‚´ê³  ë°›ê¸° ìœ„í•œ IP ì£¼ì†Œ ë˜ëŠ” í˜¸ìŠ¤íŠ¸ ì´ë¦„ ì„ ì§€ì •í•©ë‹ˆë‹¤.
** `wd_lifecheck_method` ê°€ 'heartbeat' ë¡œ ì„¤ì •ëœ ê²½ìš°ì—ë§Œ ì ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì—ë§Œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* *heartbeat_port[n] = 9694*
** default = 9694
** heartbeat ì‹ í˜¸ë¥¼ ë³´ë‚´ê³  ë°›ê¸° ìœ„í•œ í¬íŠ¸ ë²ˆí˜¸ë¥¼ ì§€ì •í•©ë‹ˆë‹¤. ì—¬ê¸°ì— í•˜ë‚˜ì˜ í¬íŠ¸ ë²ˆí˜¸ë§Œ ì§€ì •í•˜ì‹­ì‹œì˜¤.
** `wd_lifecheck_method` ê°€ 'heartbeat' ë¡œ ì„¤ì •ëœ ê²½ìš°ì—ë§Œ ì ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì—ë§Œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* *heartbeat_device[n] = ''*
** heartbeat ì‹ í˜¸ë¥¼ ë³´ë‚´ê³  ë°›ê¸° ìœ„í•œ ë„¤íŠ¸ì›Œí¬ ì¥ì¹˜ ì´ë¦„ì„ ì§€ì •í•©ë‹ˆë‹¤.
** Pgpool-II ê°€ ë£¨íŠ¸ ê¶Œí•œìœ¼ë¡œ ì‹œì‘ëœ ê²½ìš°ì—ë§Œ ì ìš©ë©ë‹ˆë‹¤ . ê·¸ë ‡ì§€ ì•Šì€ ê²½ìš° ë¹ˆ ë¬¸ìì—´('')ë¡œ ë‘ì‹­ì‹œì˜¤.
** `wd_lifecheck_method` ê°€ 'heartbeat' ë¡œ ì„¤ì •ëœ ê²½ìš°ì—ë§Œ ì ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì—ë§Œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* *wd_heartbeat_keepalive = 2*
** default = 2
** heartbeat ì‹ í˜¸ë¥¼ ë³´ë‚´ëŠ” ê°„ê²©(ì´ˆ)ì„ ì§€ì •í•©ë‹ˆë‹¤.
** `wd_lifecheck_method` ê°€ 'heartbeat' ë¡œ ì„¤ì •ëœ ê²½ìš°ì—ë§Œ ì ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì—ë§Œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* *wd_heartbeat_deadtime = 30*
** default = 2
** í•´ë‹¹ ì‹œê°„ ë‚´ì— heartbeat ì‹ í˜¸ê°€ ìˆ˜ì‹ ë˜ì§€ ì•ŠëŠ” ê²½ìš° ì›ê²© watchdog ë…¸ë“œë¥¼ failed/dead ë…¸ë“œë¡œ í‘œì‹œí•˜ê¸° ì „ì˜ ì‹œê°„(ì´ˆ)ì„ ì§€ì •í•©ë‹ˆë‹¤. 
** `wd_lifecheck_method` ê°€ 'heartbeat' ë¡œ ì„¤ì •ëœ ê²½ìš°ì—ë§Œ ì ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.
** ì´ íŒŒë¼ë¯¸í„°ëŠ” ì„œë²„ ì‹œì‘ì‹œì—ë§Œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

== Connection Pooling
=== Connection Pooling ì´ë€?
* ìƒˆë¡œìš´ ì—°ê²°ì´ ë“¤ì–´ì˜¬ë•Œ ë™ì¼í•œ ì†ì„±ì´ ë“¤ì–´ì˜¤ë©´ ì¬ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.

=== Connection Pooling Child Process í™•ì¸
* ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ child processì˜ ì—°ê²°ìƒíƒœë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
-----
psql -p 9999 -c "SHOW POOL_PROCESSES;"

-[ RECORD 1 ]-----------+--------------------
pool_pid                | 12549
start_time              | 2022-09-14 21:45:48
client_connection_count | 0
database                |
username                |
backend_connection_time |
pool_counter            |
status                  | Wait for connection
-[ RECORD 2 ]-----------+--------------------
pool_pid                | 12550
start_time              | 2022-09-14 21:45:48
client_connection_count | 0
database                |
username                |
backend_connection_time |
pool_counter            |
status                  | Wait for connection
-[ RECORD 3 ]-----------+--------------------
pool_pid                | 12784
start_time              | 2022-09-14 21:50:50
client_connection_count | 0
database                |
username                |
backend_connection_time |
pool_counter            |
status                  | Wait for connection
-[ RECORD 4 ]-----------+--------------------
pool_pid                | 12552
start_time              | 2022-09-14 21:45:48
client_connection_count | 0
database                |
username                |
backend_connection_time |
pool_counter            |
status                  | Wait for connection
....
-----

* *connection_cache* 
** default = on
** ë°±ì—”ë“œì— ëŒ€í•œ ì—°ê²°ì„ ìºì‹œí•©ë‹ˆë‹¤. templateì™€ postgresë° regress databaseëŠ” connection_cacheë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

    
* *max_pool* 
** default = 4
** pgpool-IIì˜ ìì‹í”„ë¡œì„¸ìŠ¤ë§ˆë‹¤ ê°€ì§„ ì—°ê²° ìºì‹œì˜ ìˆ˜ì…ë‹ˆë‹¤.
** ìºì‹œëœ ì—°ê²° ìˆ˜ê°€ max_poolì„ ë„˜ìœ¼ë©´ ê°€ì¥ ì˜¤ë˜ëœ ì—°ê²°ì´ ì‚­ì œë˜ê³  ìƒˆ ì—°ê²°ì— í•´ë‹¹ slotì„ ì‚¬ìš©í•©ë‹ˆë‹¤. 
** pgpoolì˜ pool ê°œìˆ˜ëŠ” num_init_children(default:32) * max_pool ì…ë‹ˆë‹¤.(default = 128)

    
* *listen_backlog_multiplier* 
** í”„ë¡ íŠ¸ì—”ë“œë¡œë¶€í„° ì—°ê²° íì˜ ê¸¸ì´ì…ë‹ˆë‹¤. 
** íì˜ ê¸¸ì´ëŠ” listen_backlog_multiplier*num_init_childrenìœ¼ë¡œ ì •ì˜ë©ë‹ˆë‹¤.
*** ì‹¤ì œë¡œ listen() system callì— ì˜í•œ â€œbacklogâ€ íŒŒë¼ë¯¸í„°
    
* *serialize_accept* 
** í•´ë‹¹ íŒŒë¼ë¯¸í„°ë¥¼ oní•˜ë©´ serial í†µì‹ ì„ í™œì„±í™”í•©ë‹ˆë‹¤. 
** children í”„ë¡œì„¸ìŠ¤ì— accept()ë¥¼ ì‹¤í–‰í•˜ì—¬ ê¹¨ìš¸ ë•Œ ëª¨ë“  í”„ë¡œì„¸ìŠ¤ê°€ ê¹¨ì–´ë‚˜ë¯€ë¡œ context switchingì´ ë§ì´ ì¼ì–´ë‚©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ íŒŒë¼ë¯¸í„°ë¥¼ í™œì„±í™”í•˜ë©´ ê° children í”„ë¡œì„¸ìŠ¤ë§Œ ë°˜ì‘í•˜ì—¬ ì„±ëŠ¥ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    
* *child_life_time*   
** default = 300
** idle ìƒíƒœë¡œ ìœ ì§€ë˜ëŠ” child processì˜ ì‹œê°„ì„ ì§€ì •í•©ë‹ˆë‹¤. í•´ë‹¹ ì‹œê°„ì´ ì§€ë‚˜ë©´ í•´ë‹¹ child processëŠ” ì¢…ë£Œë©ë‹ˆë‹¤. ë‹¨ìœ„ëŠ” s(ì´ˆ)ì…ë‹ˆë‹¤.


NOTE: ì—¬ê¸°ì„œ serialize_acceptëŠ” child_life_timeì´ í™œì„±í™” ë˜ë©´ ì‚¬ìš©í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ serialize_accept íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ child_life_timeì„ 0ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ ë¹„í™œì„±í™” í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.

* *client_idle_limit*  
** default = 0(off)
** ë§ˆì§€ë§‰ ì¿¼ë¦¬ ì´í›„ì— idleìƒíƒœë¡œ ë‚¨ì•„ìˆëŠ” ìì‹ í”„ë¡œì„¸ìŠ¤ê°€ ìˆìœ¼ë©´ í´ë¼ì´ì–¸íŠ¸ì˜ ì—°ê²°ì„ ì¢…ë£Œí•©ë‹ˆë‹¤. ë‹¨ìœ„ëŠ” s(ì´ˆ)ì…ë‹ˆë‹¤. ì„¸ì…˜ì— ëŒ€í•´ ì„¤ì •ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.(PGPOOL SET)

* *child_max_connections* 
** ê¸°ë³¸ê°’ : 0(off)
** pgpoolì˜ child processê°€ ìˆ˜ì‹ í•  ìˆ˜ ìˆëŠ” client ì—°ê²° ìˆ˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ, child prcoessì˜ ìˆ˜ëª…ì„ ì§€ì •í•©ë‹ˆë‹¤. 
** child_max_connectionë§Œí¼ connectionì´ ëë‚œ í›„ì—ëŠ” child processê°€ ì¢…ë£Œë˜ê³  ìƒˆë¡œìš´ child processë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

* *connection_life_time* 
** default = 0(off)
** ìºì‹œëœ ì—°ê²°ì˜ life timeì„ ê²°ì •í•©ë‹ˆë‹¤. ë‹¨ìœ„ëŠ” ì´ˆì…ë‹ˆë‹¤.

* *reset_query_list* 
    ì‚¬ìš©ìì˜ ì„¸ì…˜ì„ ì¢…ë£Œí•  ë•Œ ë°±ì—”ë“œì˜ ì—°ê²°ì´ resetë  ë•Œ ì „ì†¡í•  SQL ëª…ë ¹ì„ ì§€ì •í•©ë‹ˆë‹¤. ëª…ë ¹ì–´ëŠ” ":"ë¬¸ìë¡œ ì—¬ëŸ¬ commandë¥¼ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

** ê¸°ë³¸ê°’ : 'ABORT; DISCARD ALL'

[width="90%", options="header",cols="1,2"]
|=========================
|PostgreSQL version|	reset_query_list
|7.1 or earlier	|'ABORT'
|7.2 to 8.2	|'ABORT; RESET ALL; SET SESSION AUTHORIZATION DEFAULT'
|8.3 or later |'ABORT; DISCARD ALL'
|=========================


== Health Check
=== health checkë€?
* Pgpool-II ëŠ” êµ¬ì„±ëœ PostgreSQL ë°±ì—”ë“œì— ì£¼ê¸°ì ìœ¼ë¡œ ì—°ê²°í•˜ì—¬ ì„œë²„ ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ì˜ ì˜¤ë¥˜ë¥¼ ê°ì§€í•©ë‹ˆë‹¤. ì´ ì˜¤ë¥˜ ê²€ì‚¬ ì ˆì°¨ë¥¼ `"health Check"` ë¼ê³  í•©ë‹ˆë‹¤. 

=== health checkì˜ íŠ¹ì§•
* ì˜¤ë¥˜ê°€ ê°ì§€ë˜ë©´ Pgpool-II ëŠ” êµ¬ì„±ì— ë”°ë¼ ì¥ì•  ì¡°ì¹˜(failover) ë˜ëŠ” í‡´í™”(degeneration)ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.

   ğŸ’¡ health Checkì—ëŠ” ê° ë°±ì—”ë“œ ë…¸ë“œì— ëŒ€í•œ í•˜ë‚˜ì˜ ì¶”ê°€ ì—°ê²°ì´ í•„ìš”í•˜ë¯€ë¡œ postgresql.conf ì˜   `max_connections` ë¥¼ ì ì ˆí•˜ê²Œ ì¡°ì •í•´ì•¼ í•©ë‹ˆë‹¤.

* health checkë¥¼ í•´ì•¼ pg_status, pg_roleì— ëŒ€í•œ ì •ë³´ê°€ í™œì„±í™”ë˜ì–´ í™•ì¸í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.
* health check ë§¤ê°œë³€ìˆ˜ ì´ë¦„ì€ ê° ì´ë¦„ ëì— ìˆ«ì ì ‘ë¯¸ì‚¬ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
.. ì ‘ë¯¸ì‚¬ëŠ” backend_hostname ê³¼ ê°™ì€ ë°±ì—”ë“œ ì •ë³´ì— ì •ì˜ëœ ë°±ì—”ë“œ IDì— í•´ë‹¹í•©ë‹ˆë‹¤ . 
.. ì˜ˆë¥¼ ë“¤ì–´ health_check_timeout0 ì€ ë°±ì—”ë“œ 0ì˜ health_check_timeout ê°’ì— ì ìš©ë©ë‹ˆë‹¤.
.. ì ‘ë¯¸ì‚¬ê°€ ì—†ëŠ” ë§¤ê°œë³€ìˆ˜ ì´ë¦„ì€ "ì „ì—­ ë³€ìˆ˜"ì²˜ëŸ¼ ì‘ë™í•©ë‹ˆë‹¤.


=== health check stats (í†µê³„ ë°ì´í„°)
* health check processëŠ” ì´ health chcek íšŸìˆ˜ ë“± ë‹¤ì–‘í•œ í†µê³„ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤.
.. ë°ì´í„°ëŠ” shared memory ì˜ì—­ì— ì €ì¥ë˜ë©° pgpool-IIì´ ì‹œì‘ë  ë•Œ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.
.. ì•„ë˜ ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ìˆ˜ì§‘í•œ í†µê³„ ë°ì´í„°ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

* health check stats í™•ì¸ 
----
psql -p 9999 -c "SHOW POOL_HEALTH_CHECK_STATS"

-[ RECORD 1 ]----------------+--------------------
node_id                      | 0
hostname                     | 192.168.40.142
port                         | 5432
status                       | up
role                         | standby
last_status_change           | 2022-09-14 21:45:48
total_count                  | 2
success_count                | 2
fail_count                   | 0
skip_count                   | 0
retry_count                  | 0
average_retry_count          | 0.000000
max_retry_count              | 0
max_duration                 | 4
min_duration                 | 4
average_duration             | 4.000000
last_health_check            | 2022-09-14 21:45:58
last_successful_health_check | 2022-09-14 21:45:58
last_skip_health_check       |
last_failed_health_check     |
-[ RECORD 2 ]----------------+--------------------
node_id                      | 1
hostname                     | 192.168.40.137
port                         | 5432
status                       | up
role                         | primary
last_status_change           | 2022-09-14 21:45:48
total_count                  | 2
success_count                | 2
fail_count                   | 0
skip_count                   | 0
retry_count                  | 0
average_retry_count          | 0.000000
max_retry_count              | 0
max_duration                 | 2
min_duration                 | 2
average_duration             | 2.000000
last_health_check            | 2022-09-14 21:45:58
last_successful_health_check | 2022-09-14 21:45:58
last_skip_health_check       |
last_failed_health_check     |
---- 

* health check stats í•­ëª©  

[width="100%", options="header",cols="1,15"]
|==================================
|ìˆ˜ì§‘ ì •ë³´ | ì„¤ëª…
|node_id |	ë°±ì—”ë“œ ë…¸ë“œ IDì…ë‹ˆë‹¤.
|hostname |	ë°±ì—”ë“œ í˜¸ìŠ¤íŠ¸ ì´ë¦„ ë˜ëŠ” UNIX ë„ë©”ì¸ ì†Œì¼“ ê²½ë¡œì…ë‹ˆë‹¤.
|port|	ë°±ì—”ë“œ í¬íŠ¸ ë²ˆí˜¸ì…ë‹ˆë‹¤.
|status |	ë°±ì—”ë“œ ìƒíƒœë¥¼ ë‚˜íƒ€ë‚´ë©° up, down, waiting, unused, quarantine ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤.
|role |	ë…¸ë“œì˜ ì—­í• . ìŠ¤íŠ¸ë¦¬ë° ë³µì œ ëª¨ë“œì˜ Primary ë˜ëŠ” Standby ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. ë‹¤ë¥¸ ëª¨ë“œì˜ main ë˜ëŠ” replicaì…ë‹ˆë‹¤.
|last_status_change |	ë§ˆì§€ë§‰ìœ¼ë¡œ ë…¸ë“œë¥¼ í™•ì¸í•œ ì‹œê°„ì…ë‹ˆë‹¤.
|total_count | health checkë¥¼ í•œ ì´ íšŸìˆ˜ì…ë‹ˆë‹¤.
|success_count | health checkë¥¼ ì„±ê³µí•œ íšŸìˆ˜ì…ë‹ˆë‹¤.
|fail_count	 | health checkë¥¼ ì‹¤íŒ¨í•œ íšŸìˆ˜ì…ë‹ˆë‹¤.
|skip_count | health checkë¥¼ skipí•œ íšŸìˆ˜ì…ë‹ˆë‹¤. ë…¸ë“œê°€ ì´ë¯¸ ë‹¤ìš´ëœ ê²½ìš° ìƒíƒœ í™•ì¸ì—ì„œ ë…¸ë“œë¥¼ ê±´ë„ˆëœë‹ˆë‹¤.
|retry_count | ì´ ì¬ì‹œë„ëœ health check íšŸìˆ˜ì…ë‹ˆë‹¤.
|average_retry_count |	í•œ ì„¸ì…˜ì—ì„œ health checkë¥¼ ì¬ì‹œë„í•œ íšŸìˆ˜ì˜ í‰ê· ì…ë‹ˆë‹¤.
|max_retry_count | í•œ ì„¸ì…˜ì—ì„œ health checkë¥¼ ê°€ì¥ ë§ì´ í•œ max ê°’ì…ë‹ˆë‹¤.
|max_duration | ìµœëŒ€ health check ì‹œê°„(ms)ì…ë‹ˆë‹¤. health check ì„¸ì…˜ì´ ì¬ì‹œì‘ëœë‹¤ë©´ ì¬ì‹œì‘í•˜ëŠ” ì‹œê°„ë„ í•©í•˜ì—¬ maxê°’ìœ¼ë¡œ ì¶•ì •í•©ë‹ˆë‹¤.
|min_duration | ìµœì†Œ health check ì‹œê°„(ms)ì…ë‹ˆë‹¤. health check ì„¸ì…˜ì´ ì¬ì‹œì‘ëœë‹¤ë©´ ì¬ì‹œì‘í•˜ëŠ” ì‹œê°„ë„ í•©í•˜ì—¬ minê°’ìœ¼ë¡œ ì¶•ì •í•©ë‹ˆë‹¤.
|average_duration | í‰ê·  health check ì‹œê°„(ms)ì…ë‹ˆë‹¤. health check ì„¸ì…˜ì´ ì¬ì‹œì‘ëœë‹¤ë©´ ì¬ì‹œì‘í•˜ëŠ” ì‹œê°„ë„ í•©í•˜ì—¬ í•œ ì„¸ì…˜ì˜ ì‹œê°„ìœ¼ë¡œ ì¶•ì •í•©ë‹ˆë‹¤.
|last_health_check | ë§ˆì§€ë§‰ health checkì˜ íƒ€ì„ìŠ¤íƒ¬í”„ì…ë‹ˆë‹¤. heath checkê°€ ì•„ì§ ìˆ˜í–‰ë˜ì§€ ì•Šì€ ê²½ìš° ë¹ˆ ë¬¸ìì—´ì…ë‹ˆë‹¤.
|last_successful_health_check | ë§ˆì§€ë§‰ìœ¼ë¡œ ì„±ê³µí•œ health checkì˜ íƒ€ì„ìŠ¤íƒ¬í”„ì…ë‹ˆë‹¤. health checkê°€ ì•„ì§ ì„±ê³µí•˜ì§€ ëª»í•œ ê²½ìš° ë¹ˆ ë¬¸ìì—´ì…ë‹ˆë‹¤.
|last_skip_health_check | ë§ˆì§€ë§‰ìœ¼ë¡œ health checkë¥¼ skipí•œ íƒ€ì„ìŠ¤íƒ¬í”„ì…ë‹ˆë‹¤. health checkì„ ì•„ì§ ê±´ë„ˆë›°ì§€ ì•Šì€ ê²½ìš° ë¹ˆ ë¬¸ìì—´ì…ë‹ˆë‹¤. statusê°€ downëœ ê²½ìš°ì—ë„ ì´ í•„ë“œê°€ ë¹ˆ ë¬¸ìì—´ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš° failoverëŠ” health check í”„ë¡œì„¸ìŠ¤ê°€ ì•„ë‹Œ ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ì— ì˜í•´ íŠ¸ë¦¬ê±° ë˜ì–´ì„œ ë¹ˆ ë¬¸ìì—´ë¡œ ë‚˜ì˜¤ê²Œ ë©ë‹ˆë‹¤.
|last_falied_health_check | ë§ˆì§€ë§‰ìœ¼ë¡œ ì‹¤íŒ¨í•œ health checkì˜ íƒ€ì„ìŠ¤íƒ¬í”„ì…ë‹ˆë‹¤. health checkê°€ ì•„ì§ ì‹¤íŒ¨í•˜ì§€ ì•Šìœ¼ë©´ ë¹ˆ ë¬¸ìì—´ì…ë‹ˆë‹¤. statusê°€ downëœ ê²½ìš°ì—ë„ ì´ í•„ë“œê°€ ë¹ˆ ë¬¸ìì—´ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš° failoverëŠ” health check í”„ë¡œì„¸ìŠ¤ê°€ ì•„ë‹Œ ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ì— ì˜í•´ íŠ¸ë¦¬ê±° ë˜ì–´ì„œ ë¹ˆ ë¬¸ìì—´ë¡œ ë‚˜ì˜¤ê²Œ ë©ë‹ˆë‹¤.
|==================================


== Load Balancing
* SELECT ì¿¼ë¦¬ì˜ Pgpool-II load balancingì€ raw modeë¥¼ ì œì™¸í•œ ëª¨ë“  í´ëŸ¬ìŠ¤í„°ë§ ëª¨ë“œì—ì„œ ì‘ë™í•©ë‹ˆë‹¤.
* load balancing ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” `pgpool.conf` ì— `load_balance_mode` ë¥¼ ONí•©ë‹ˆë‹¤.
----
load_balance_mode = on
----

* ì•„ë˜ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ load balancing ë…¸ë“œë¡œ í• ë‹¹ëœ DB ë…¸ë“œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ .
----
psql -p 9999 -c "SHOW POOL_NODES"

-[ RECORD 1 ]----------+--------------------
node_id                | 0
hostname               | 192.168.40.142
port                   | 5432
status                 | up
pg_status              | up
lb_weight              | 0.500000
role                   | standby
pg_role                | standby
select_cnt             | 0
load_balance_node      | true
replication_delay      | 0
replication_state      | streaming
replication_sync_state | async
last_status_change     | 2022-09-14 21:45:48
-[ RECORD 2 ]----------+--------------------
node_id                | 1
hostname               | 192.168.40.137
port                   | 5432
status                 | up
pg_status              | up
lb_weight              | 0.500000
role                   | primary
pg_role                | primary
select_cnt             | 0
load_balance_node      | false
replication_delay      | 0
replication_state      |
replication_sync_state |
last_status_change     | 2022-09-14 21:45:48
----

== Failover
=== Failoverë€?
* failoverì€ pgpool-II ì—ì„œ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ì—†ëŠ” PostgreSQL ë°±ì—”ë“œ ë…¸ë“œë¥¼ ìë™ìœ¼ë¡œ ë¶„ë¦¬í•˜ëŠ” ê²ƒì„ ì˜ë¯¸ í•©ë‹ˆë‹¤. ì´ëŠ” êµ¬ì„± ë§¤ê°œë³€ìˆ˜ ì„¤ì •ì— ê´€ê³„ì—†ì´ ìë™ìœ¼ë¡œ ë°œìƒí•˜ë©° ìë™ ì¥ì•  ì¡°ì¹˜(failover ) í”„ë¡œì„¸ìŠ¤ë¼ê³  í•©ë‹ˆë‹¤. 

=== Failoverì˜ íŠ¹ì§•

* pgpool-II ëŠ” ë‹¤ìŒ ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ PostgreSQL ë°±ì—”ë“œ ë…¸ë“œ ì˜ ì•¡ì„¸ìŠ¤ ë¶ˆê°€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
** health check í”„ë¡œì„¸ìŠ¤ëŠ” ìƒíƒœë¥¼ í™•ì¸í•˜ê¸°ìœ„í•´ Pgpool-II ì—ì„œ PostgreSQL ë…¸ë“œë¡œ ì—°ê²°ì„ ì‹œë„í•©ë‹ˆë‹¤. ì—°ê²°ì— ì‹¤íŒ¨í•˜ë©´ Pgpool-II ì™€ PostgreSQL ê°„ì˜ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì— ë¬¸ì œê°€ ìˆê±°ë‚˜ PostgreSQL ì´ ì œëŒ€ë¡œ ì‘ë™í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. Pgpool-II ëŠ” ê° ê²½ìš°ë¥¼ êµ¬ë¶„í•˜ì§€ ì•Šê³  ìƒíƒœ í™•ì¸ì— ì‹¤íŒ¨í•˜ë©´ íŠ¹ì • PostgreSQL ë…¸ë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤ê³  ê²°ì •í•©ë‹ˆë‹¤.
** PostgreSQL ì— ì—°ê²°í•˜ëŠ” ë™ì•ˆ ì˜¤ë¥˜ê°€ ë°œìƒ í•˜ê±°ë‚˜ í†µì‹ í•˜ëŠ” ë™ì•ˆ ë„¤íŠ¸ì›Œí¬ ìˆ˜ì¤€ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ ê²½ìš° `failover_on_backend_error` ê°€ êº¼ì ¸ ìˆìœ¼ë©´ Pgpool-II ëŠ” í´ë¼ì´ì–¸íŠ¸ì— ëŒ€í•œ ì„¸ì…˜ ì—°ê²°ì„ ëŠìŠµë‹ˆë‹¤.
** í´ë¼ì´ì–¸íŠ¸ê°€ ì´ë¯¸ Pgpool-II ì— ì—°ê²°ë˜ì–´ ìˆê³  PostgreSQL ì´ ì¢…ë£Œëœ ê²½ìš°
* `failover_command` ê°€ ì„¤ì •ë˜ì–´ ìˆê³  failoverê°€ ë°œìƒí•˜ë©´ `failover_command` ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤. 
** `failover_command` ëŠ” ì‚¬ìš©ìê°€ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤.
** ìƒì„±í•œ failover ìŠ¤í¬ë¦½íŠ¸ëŠ” pgpoolì„ ì‹¤í–‰í•œ OS ìœ ì €ì˜ ì‹¤í–‰ ê¶Œí•œì„ ë¶€ì—¬í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.
** failover_command ì¸ì

[width="60%", options="header",cols="1,6"]
|========================
|%d | Detachëœ DB node ID
|%h | Detachëœ Nodeì˜ Hostname
|%p | Detachëœ Nodeì˜ Port ë²ˆí˜¸
|%D | Detachëœ Nodeì˜ Database cluster ë””ë ‰í† ë¦¬
|%m | ìƒˆë¡œìš´ main nodeì˜ ID
|%H | ìƒˆë¡œìš´ main nodeì˜ ID
|%M | ì´ì „ main node ID
|%P | ì´ì „ primary node ID
|%r | ìƒˆë¡œìš´ main nodeì˜ Port ë²ˆí˜¸
|%R |  ìƒˆë¡œìš´ nodeì˜ Database cluster directory
|%N | Hostname of the old primary node (Pgpool-II 4.1 or after)
|%S | Port number of the old primary node (Pgpool-II 4.1 or after)
|%% | '%' character
|========================

* failover ëª…ë ¹ì˜ ì£¼ìš” ì—­í• ì€ ì˜ˆë¥¼ ë“¤ì–´ ê¸°ì¡´ Standby ì„œë²„ì—ì„œ ìƒˆ Primary ì„œë²„ë¥¼ ì„ íƒí•˜ê³  promoteí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ë˜ ë‹¤ë¥¸ ì˜ˆëŠ” ê´€ë¦¬ìì—ê²Œ ë©”ì¼ì„ ë³´ë‚´ failoverê°€ ë°œìƒí•¨ì„ ì•Œë¦¬ëŠ” ê²ƒì…ë‹ˆë‹¤.

* follow_primary_commandëŠ” ë…¸ë“œê°€ 2ê°œì¼ ê²½ìš°ì—ëŠ” failover ìƒí™©ì—ì„œ standbyì—ê²Œ ìƒˆë¡œìš´ Primary ë…¸ë“œë¥¼ ì•Œë ¤ì¤„ í•„ìš”ê°€ ì—†ì§€ë§Œ, 3ê°œ ì´ìƒì˜ ë…¸ë“œì˜ ê²½ìš°ì—ëŠ” follow_primary_commandë¥¼ ì´ìš©í•˜ì—¬ ìƒˆë¡œìš´ Primaryë¡œ ì—°ê²°í•˜ëŠ” ê²ƒì´ í•„ìš”í•©ë‹ˆë‹¤. ì¸ìëŠ” failover_commandì™€ ë™ì¼í•˜ë‹¤.

== Auto Failback
=== Auto Failbackì´ë€?
* ì¼ì‹œì ì¸ ë„¤íŠ¸ì›Œí¬ ë¬¸ì œë¡œ ì¸í•´ ì •ìƒì ì¸ ëŒ€ê¸° PostgreSQL ì„œë²„ê°€ Pgpool-IIì—ì„œ ë¶„ë¦¬ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¶„ë¦¬ëœ ëŒ€ê¸° PostgreSQL ì„œë²„ë¥¼ ë‹¤ì‹œ ì—°ê²°í•˜ë ¤ë©´ ì •ìƒì ì¸ ëŒ€ê¸° ì„œë²„ì¸ì§€ í™•ì¸í•œ ë‹¤ìŒ ìˆ˜ë™ìœ¼ë¡œ pcp_attach_node ëª…ë ¹ì„ ì‹¤í–‰í•˜ê±°ë‚˜ Pgpool-IIë¥¼ ë‹¤ì‹œ ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤. 
* Pgpool-II 4.1ë¶€í„° auto_failback ì„ í™œì„±í™”í•˜ì—¬ ì •ìƒì ì¸ Standby PostgreSQL ì„œë²„ë¥¼ ìë™ìœ¼ë¡œ ë‹¤ì‹œ ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

=== Auto Failbackì˜ íŠ¹ì§•
* pgpool-IIì€ pg_stat_replicationìœ¼ë¡œë¶€í„° Primary ì„œë²„ì™€ Standby ì„œë²„ê°„ì˜ ì—°ê²°ì„ í™•ì¸í•˜ê¸° ìœ„í•´ ì£¼ê¸°ì ìœ¼ë¡œ ì •ë³´ë¥¼ ê²€ìƒ‰í•˜ê¸° ë•Œë¬¸ì— PostgreSQL 9.1 ì´ìƒì´ í•„ìš”í•©ë‹ˆë‹¤.
* pgpool-IIëŠ” ë‹¤ìŒ ì¡°ê±´ì´ ì¶©ì¡±ë˜ëŠ” ê²½ìš° PostgreSQL ì„œë²„ë¥¼ ì—°ê²°í•©ë‹ˆë‹¤.
** Standby PostgreSQL ì„œë²„ì¸ ê²½ìš°
** PostgreSQL ì„œë²„ì˜ ìƒíƒœê°€ downëœ ê²½ìš° (pgpool-II ì—ì„œ ê´€ë¦¬í•˜ëŠ” ìƒíƒœ)
** pg_stat_replication.stateê°€ streaming ì¸ ê²½ìš°
* Auto Failbackì„ í™œì„±í™” í•˜ë ¤ë©´ ë‹¤ìŒ ë§¤ê°œë³€ìˆ˜ë¥¼ ì„¤ì •í•´ì•¼í•©ë‹ˆë‹¤.
----
auto_failback = on
auto_failback_interval 
health_check_user
health_check_password
sr_check_user
sr_check_password
backend_application_name*
----

   ğŸ’¡ replication slotì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° auto failbackì´ ì‘ë™í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. failover_commandê°€ ì‹¤í–‰ë˜ê³  ëª…ë ¹ì–´ì— ì˜í•´ replication slotì´ ì‚­ì œë˜ê¸° ë•Œë¬¸ì— ìŠ¤íŠ¸ë¦¬ë° ë³µì œê°€ ì¤‘ì§€ë  ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë¯€ë¡œ Standby PostgreSQL ì„œë²„ë¥¼ ë‹¤ì‹œ ì‹œì‘í•˜ê¸° ì „ì— replication slotì„ ë‹¤ì‹œ ìƒì„±í•´ì•¼í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.


== Online Recovery
=== Online Recovery ë€?
* pgpool-II ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ë…¸ë“œë¥¼ ë™ê¸°í™”í•˜ê³  ì„œë¹„ìŠ¤ë¥¼ ì¤‘ì§€í•˜ì§€ ì•Šê³  ë…¸ë“œë¥¼ ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê¸°ëŠ¥ì„ "online Recovery"ë¼ê³  í•©ë‹ˆë‹¤. 
* online RecoveryëŠ” `pcp_recovery_node` ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

=== Online Recoveryì˜ íŠ¹ì§•
* online RecoveryëŠ” ë³µêµ¬ ëŒ€ìƒ ë…¸ë“œê°€ ë¶„ë¦¬ëœ ìƒíƒœì—¬ì•¼ í•©ë‹ˆë‹¤. 
** ë…¸ë“œê°€ `pcp_detach_node` ì— ì˜í•´ ìˆ˜ë™ìœ¼ë¡œ ë¶„ë¦¬ë˜ê±°ë‚˜ failoverì˜ ê²°ê³¼ë¡œ pgpool-IIì— ì˜í•´ ìë™ìœ¼ë¡œ ë¶„ë¦¬ë˜ì–´ì•¼ í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

   ğŸ’¡ online Recoveryë¥¼ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ ë³µêµ¬ ëŒ€ìƒ PostgreSQL ì„œë²„ê°€ ì‹¤í–‰ë˜ê³  ìˆì§€ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤. ëŒ€ìƒ PostgreSQL ì„œë²„ê°€ ì´ë¯¸ ì‹œì‘ëœ ê²½ìš° online Recoveryë¥¼ ì‹œì‘í•˜ê¸° ì „ì— ì¢…ë£Œí•´ì•¼ í•©ë‹ˆë‹¤.

=== online Recoveryì˜ ê³¼ì •
* online RecoveryëŠ” ë‘ ë‹¨ê³„ë¡œ ìˆ˜í–‰ë©ë‹ˆë‹¤. ì²«ë²ˆì§¸ ë‹¨ê³„ë¥¼ "1st stage", ë‘ë²ˆì§¸ ë‹¨ê³„ë¥¼ "2nd stage"ë¼ê³  í•©ë‹ˆë‹¤.
** 2nd stageëŠ” `native_replication_mode` ë° `snapshot_isolation_mode` ì—ë§Œ í•„ìš”í•©ë‹ˆë‹¤. 
** streaming replication modeë¥¼ í¬í•¨í•œ ë‹¤ë¥¸ ëª¨ë“œì˜ ê²½ìš° 2nd stageê°€ ìˆ˜í–‰ë˜ì§€ ì•Šìœ¼ë©° `recovery_2nd_stage_command` ì—ì„œ ë‹¨ê³„ì— ëŒ€í•œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì œê³µí•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤. ì¦‰, ë¹ˆ ë¬¸ìì—´ë¡œ ì•ˆì „í•˜ê²Œ ë‚¨ê²¨ë‘˜ ìˆ˜ ìˆìŠµë‹ˆë‹¤.






pcp_recovery_nodeë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒˆ Primaryì—ì„œ Standbyë¥¼ ë³µêµ¬í•˜ëŠ”ë° ì‚¬ìš©ë©ë‹ˆë‹¤.

- pcp_promote_node ëª…ë ¹ì— ì˜í•´ node promoteê°€ ì´ë£¨ì–´ì§„ ê²½ìš° ì‹¤í–‰
- Streaming Replicationì—ì„œë§Œ ë™ì‘

ë…¸ë“œë¥¼ ë™ê¸°í™”í•˜ê³  ì„œë¹„ìŠ¤ë¥¼ ì¤‘ì§€í•˜ì§€ ì•Šê³  ë…¸ë“œë¥¼ ì—°ê²°í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ â€œOnline Recoveryâ€ë¼ê³  í•©ë‹ˆë‹¤. pcp_recovery_node ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ Online Recoveryë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

**pgpool_recoveryí•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ë°˜ë“œì‹œ ì„¤ì¹˜í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.**



[source, SQL]
----
template1=# CREATE EXTENSION pgpool_recovery;
----

ë‘ stageë¡œ ë‚˜ëˆ„ì–´ì§€ëŠ”ë° ë‘ë²ˆì§¸ stageëŠ” native_replication_mode, snapshot_isolationi_modeì—ë§Œ í•„ìš”í•©ë‹ˆë‹¤.

1. CHECKPOINT
2. â€œfirst stageâ€ëŠ” pg_basebackupì„ í†µí•´ primary nodeì˜ ë‚´ìš©ì„ ë³µì œí•œë‹¤.
3. ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ì˜ ì—°ê²°ì´ ëŠì–´ì§ˆë•Œê¹Œì§€ ê¸°ë‹¤ë¦°ë‹¤.(native_replication_mode, snapshot_isolationi_mode)
4. CHECKPOINT(native_replication_mode, snapshot_isolationi_mode)
5. â€œsecond stageâ€ëŠ” ëŒ€ìƒ ë³µêµ¬ ë…¸ë“œê°€ ì‹œì‘ëœë‹¤. íŠ¸ëœì­ì…˜ ë¡œê·¸ê°€ ì¬ìƒë˜ê³  ë³µì œë³¸ ë…¸ë“œê°€ ë§ˆìŠ¤í„° ë…¸ë“œì™€ ì™„ì „íˆ ë™ê¸°í™”ëœë‹¤. (native_replication_mode, snapshot_isolationi_mode)
6. postmaster ì‹œì‘(**pgpool_remote_start** ìˆ˜í–‰) +
ë³µêµ¬ ëŒ€ìƒì˜ postgresSQL ë…¸ë“œë¥¼ ì‹œì‘í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ì´ë‹¤. 2ê°œì˜ ë§¤ê°œë³€ìˆ˜ ë…¸ë“œì˜ í˜¸ìŠ¤íŠ¸ì´ë¦„, ë°ì´í„°ë² ì´ìŠ¤ í´ëŸ¬ìŠ¤í„° ê²½ë¡œì´ë‹¤.

----
recovery_user = 'postgres'                 #Online Recoveryë¥¼ ì‹¤í–‰í•  PostgreSQL ì‚¬ìš©ì ì´ë¦„
recovery_password = ''                     #recovery_userì˜ íŒ¨ìŠ¤ì›Œë“œ, ë¹ˆ ì•”í˜¸ì¼ ì‹œ pool_passwd í™•ì¸
recovery_1st_stage_command = 'basebackup.sh' #ì²«ë²ˆì§¸ stageì—ì„œ ì‹¤í–‰í•  ëª…ë ¹ì„ ì§€ì •, ëª…ë ¹íŒŒì¼ì€ ë°ì´í„°ë² ì´ìŠ¤ í´ëŸ¬ìŠ¤í„° ë””ë ‰í† ë¦¬ì— ìˆì–´ì•¼ í•¨
#recovery_timeout = 90                    #ë³µêµ¬ì‹œ í•´ë‹¹ ì´ˆ(s)ê°€ ë„˜ì–´ì„œ ì™„ë£Œë˜ì§€ ì•Šìœ¼ë©´ ë³µêµ¬ë¥¼ ìµœì†Œ
#client_idle_limit_in_recovery = 0        #ë³µêµ¬ì¤‘ ë§ˆì§€ë§‰ ì¿¼ë¦¬ ì´í›„ idleìƒíƒœë¡œ ë‚¨ì•„ìˆëŠ” í´ë¼ì´ì–¸íŠ¸ ì—°ê²°ì„ ëŠëŠ”ë° ê±¸ë¦¬ëŠ” ì‹œê°„(s)ì„ ì§€ì •, 2 stageì—ì„œë§Œ ì ìš©
----

- online recovery ì‹¤í–‰

----
pcp_recovery_node -n <NODE_NUMBER> -p 9898
----

== PCP Command
PCPëŠ” â€Pgpool Control Protocolâ€ì˜ ì¤„ì„ë§ì…ë‹ˆë‹¤.

ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ë°ì´í„°ë² ì´ìŠ¤ ë…¸ë“œë¥¼ ê²€ìƒ‰í•˜ê³ , pgpoolì„ ì¢…ë£Œí•˜ëŠ” ë“±ì˜ ê´€ë¦¬ ëª©ì ì„ ìœ„í•œ ì»¤ë§¨ë“œì…ë‹ˆë‹¤. `pcp.conf` íŒŒì¼ì— ì‚¬ìš©ì ì´ë¦„ê³¼ ì•”í˜¸ë¥¼ ì •ì˜í•˜ì—¬ì•¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•”í˜¸ëŠ” md5 í•´ì‹œ í˜•ì‹ìœ¼ë¡œ ì•”í˜¸í™”ë©ë‹ˆë‹¤. ì•”í˜¸í™”í•˜ë ¤ë©´ `/usr/local/bin/pg_md5` ë¥¼ ì´ìš©í•©ë‹ˆë‹¤.

CAUTION: ì´ê²ƒì€ PCPë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ê³ ìœ ì˜ ì•„ì´ë””ì™€ passwordì´ê¸° ë•Œë¬¸ì— postgresqlê³¼ëŠ” ë¬´ê´€í•©ë‹ˆë‹¤.

[source,bash]
----
#ë¹„ë°€ë²ˆí˜¸ 'postgres' md5í˜•ì‹ìœ¼ë¡œ ìƒì„±
pg_md5 postgres
e8a48653851e28c69d0506508fb27fc5

#pcp.conf
postgres:e8a48653851e28c69d0506508fb27fc5
----

ì •ì˜ëœ PCP ëª…ë ¹ì–´ëŠ” ë„¤íŠ¸ì›Œí¬ë¥¼ ì´ìš©í•˜ì—¬ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— `pgpool.conf`ì— pcp_port íŒŒë¼ë¯¸í„°ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.

[source,sql]
----
#pgpool.conf
pcp_listen_address = '*'
pcp_port = 9898
pcp_socket_dir = '/var/run/postgresql'
----

ë˜í•œ ë¹„ë°€ë²ˆí˜¸ ì—†ì´ shellì´ë‚˜ -`w`ì˜µì…˜ì„ ì‚¬ìš©í•˜ì—¬ pcp commandë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° **ë°˜ë“œì‹œ** Home Directoryì— .pcppass íŒŒì¼ì„ ìƒì„±í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ê¶Œí•œì€ í•­ìƒ 600ìœ¼ë¡œ ì§€ì •í•œë‹¤. ì´ userì™€ ë¹„ë°€ë²ˆí˜¸ëŠ” pcp.confì— ê¸°ì…í•œ ë‚´ìš©ì…ë‹ˆë‹¤.

[source,bash]
----
#.pcppass
hostname:port:username:password
localhost:9898:postgres:postgres
----

- pcp_node_info +
nodeì˜ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆ. "show pool_nodes"ì—ì„œ ë³´ì˜€ë˜ pg_status, pg_roleì€ Backend Status Name, Backend Roleê³¼ ì¼ì¹˜í•˜ê²Œ ë©ë‹ˆë‹¤.
[source,bash]
----
pcp_node_info -p 9898 -h localhost -a -v #-w

Hostname               : 172.27.0.68
Port                   : 5432
Status                 : 1
Weight                 : 0.333333
Status Name            : waiting
Backend Status Name    : up
Role                   : primary
Backend Role           : primary
Replication Delay      : 0
Replication State      : none
Replication Sync State : none
Last Status Change     : 2022-03-10 11:22:57
----
StatusëŠ” 0,1,2,3ìœ¼ë¡œ ë‚˜ëˆ ì ¸ìˆìŠµë‹ˆë‹¤. 

- 0 : ì´ˆê¸°í™” ì¤‘ì—ë§Œ ì‚¬ìš©í•˜ë©° ìƒíƒœë¥¼ í‘œì‹œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- 1 : ë…¸ë“œê°€ ì‘ë™ ì¤‘ì´ì§€ë§Œ ì•„ì§ connectionì´ ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
- 2 : ë…¸ë“œê°€ ì‘ë™ ì¤‘ì´ë©°, ì—°ê²°ì´ pooling ë©ë‹ˆë‹¤.
- 3 : ë…¸ë“œê°€ down ë˜ì—ˆìŠµë‹ˆë‹¤.

== pgpool ì‹¤í–‰
`-f` : config fileì„¤ì •

`-F` : pcp config file ì„¤ì •

`-a` : hba config file ì„¤ì •

`-n` (--dont-detach) : ë°ëª¬ ëª¨ë“œë¡œ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ

`-D` (--discard-status) : pgpool_statusë¥¼ ì‚­ì œí•˜ê³  ì´ì „ statusë¥¼ ë³µêµ¬í•˜ì§€ ì•ŠìŒ

ì—¬ê¸° `-D`ë¥¼ í†µí•´ statusë¥¼ ì§€ìš°ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤. pgpool ìì²´ì—ì„œ pgpool_statusë¥¼ ê°±ì‹ í•´ì£¼ì§€ ì•Šì•„ ë§ˆì§€ë§‰ìœ¼ë¡œ checkí•œ ìƒíƒœê°€ ìœ ì§€ë˜ì–´ ì‹¤ì œ ìƒíƒœì™€ ë‹¤ë¥´ê²Œ ë‚˜íƒ€ë‚  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

- í•­ìƒ -D ì˜µì…˜ í™œì„±í™” +
----
vi /etc/sysconfig/pgpool
OPTS="-D -n"
----

[source, bash]
----
# ê¸°ë³¸ ì¸ìˆ˜ ì„¤ì •
pgpool -D -n -f <pgpool.conf> -F <pcp.conf> -a <pool_hba.conf> &

#log, debug message ë° ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰
pgpool -n -d > /tmp/pgpool.log &
----

== pgpool ìƒíƒœ ì¡°íšŒ

=== pgpool node ì¡°íšŒ
-----
psql -p 9999 -c "show pool_nodes;"
-----

=== pgpool ì ‘ì† í´ë¼ì´ì–¸íŠ¸ ì¡°íšŒ
-----
psql -p 9999 -c "show pool_processes;"
-----


== pgpool ì¢…ë£Œ

----
#pgpool ì¢…ë£Œ
$ pgpool stop

#pgpool ê°•ì œì¢…ë£Œ
$ pgpool -m fast stop
----

== Watchdog

vip ì„¤ì •(ncp)

private subnet ë§Œë“¤ê³ , network interface(ë¯¸í• ë‹¹)ìœ¼ë¡œ ë§Œë“¤ê¸°

í•´ë‹¹ vipì— ì ‘ì†í•˜ë ¤ë©´ ê° pg_hba.confì—ë„ ìƒˆë¡œìš´ NICì— ëŒ€í•œ ì ‘ê·¼ë„ í—ˆìš©í•´ì¤˜ì•¼  í•œë‹¤.


pgpoolì„ ì‚¬ìš©í•  nodeì—ì„œ node_idë¥¼ ì„¤ì •í•´ì£¼ì–´ì•¼í•œë‹¤.
----
vi /etc/pgpool-II/pgpool_node_id
0
----

- pgpool.conf ì„¤ì •
----
enable_pool_hba = on
use_watchdog = on
delegate_IP = {vip}
if_cmd_path = '/sbin'
if_up_cmd = '/usr/bin/sudo /sbin/ip addr add $_IP_$/24 dev {ë„¤íŠ¸ì›Œí¬} label {ë„¤íŠ¸ì›Œí¬}:0'
if_down_cmd = '/usr/bin/sudo /sbin/ip addr del $_IP_$/24 dev {ë„¤íŠ¸ì›Œí¬}'
arping_path = '/usr/sbin'
arping_cmd = '/usr/bin/sudo /usr/sbin/arping -U $_IP_$ -w 1 -I {ë„¤íŠ¸ì›Œí¬}'

#watchdogì´ ì²´í¬í•  pgpool ëŒ€ìƒ ì„¤ì •
wd_port0 = 9000
pgpool_port0 = 9999
wd_port1 = 9000
pgpool_port1 = 9999

#watchdogì˜ pgpool ì²´í¬ ë°©ì‹
wd_lifecheck_method = 'heartbeat'
wd_interval = 10
wd_heartbeat_keepalive = 2
wd_heartbeat_deadtime = 30
wd_escalation_command = '/data/pgpool/script/escalation.sh'

#watchdogê³¼ heartbeatë¥¼ ì£¼ê³ ë°›ì„ ëŒ€ìƒ ì„¤ì •
heartbeat_hostname0 = {master IP}
heartbeat_port0 = 9694
heartbeat_device0 = ''
heartbeat_hostname1 = {slave IP}
heartbeat_port1 = 9694
heartbeat_device1 = ''
----

== pgpoolì—ì„œ ì œê³µë˜ëŠ” í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
ì´ ë‹¨ë½ì€ pgpoolì— ëŒ€í•œ ê¸°ë³¸ì„ ìœ„í•˜ì—¬ ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ë¥¼ í†µí•˜ì—¬ ì´í•´ë¥¼ ë•ê¸° ìœ„í•˜ì—¬ ì‘ì„±í•©ë‹ˆë‹¤.

ì¼ë‹¨ postgresqlê³¼ pgpoolì´ ì„¤ì¹˜ë˜ì–´ìˆë‹¤ëŠ” ê°€ì •í•˜ì— ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.

1. pgpool_setupì„ ì‚¬ìš©í•˜ì—¬ sampleë¡œ ëœ pgpool, postgresql 2 NODEë¥¼ ìƒì„±í•©ë‹ˆë‹¤. + 
í˜„ì¬ ë””ë ‰í† ë¦¬ ê¸°ì¤€ìœ¼ë¡œ ìƒì„±ë˜ë©° í•´ë‹¹ ë””ë ‰í† ë¦¬ëŠ” ë°˜ë“œì‹œ ë¹„ì–´ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
    
    $ pgpool_setup
    
2. pgpool ë° pg replication 2 NODE ì‹¤í–‰

    ./startall
    
3. pgpoolì„ í†µí•´ í•´ë‹¹ Node í™•ì¸ + 
ê¸°ë³¸ì ìœ¼ë¡œ ìƒì„±ë˜ë©´ì„œ test databaseê°€ ìƒì„±ëœë‹¤.
    
image:images/pgpool_test(1).png[]
    

    -bash-4.2$ psql -p 11000 -h localhost -c "show pool_nodes" test

    

- pgbench Setting +
pgbenchë¥¼ ì´ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œ portëŠ” pgpoolì˜ portë¥¼ ì´ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ insertí•œë‹¤.

    pgbench -i -p 11000 test
    
- LoadBalnacing test
    
    pgbench -p 11000 -c 10 -j 10 -S -T 60 test
    psql -p 11000 -h localhost -c "show pool_nodes" test
    
- Auto Failover test +
pgpoolì€ primary ì„œë²„ê°€ downë¨ê³¼ ë™ì‹œì— pgpool.confì— ì‘ì„±ëœ failover_commandë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. +
`failover_command = '/var/lib/pgsql/11/test/etc/failover.sh %d %h %p %D %m %M %H %P %r %Râ€™`
    
    pg_ctl -D data0 stop
    psql -p 11000 -h localhost -c "show pool_nodes" test
    
image:images/pgpool_test(2).png[]
    
- Online Recovery test +
pcp_recovery_nodeëŠ” pgpoolê³¼ í•¨ê»˜ ì œê³µë˜ëŠ” ëª…ë ¹ì¤‘ í•˜ë‚˜ì´ë‹¤. ì—¬ê¸°ì„œ -nì€ â€œnode numberâ€ë¥¼ ê°€ë¥´í‚¤ë©°, pgpool.confì˜ recovery_1st_stage_commandë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤. +
ì—¬ê¸°ì„œ ê° Data_Clusterì— ìˆëŠ” basebackup.shë¥¼ ë™ì‘ì‹œì¼œ Setupí•©ë‹ˆë‹¤.
    
    pcp_recovery_node -p 11001 -h `hostname` -n 0
